<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    {% load static %}
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="{% static 'images/favicon.ico'%} ">

    <title>Continuous Piecewise Linear Analysis</title>

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>

    <!--控制台样式-->
    <link href="{% static 'bootstrap-4.1.1-dist/css/dashboard.css'%}" rel="stylesheet">
    <!--layui-->
    <link rel="stylesheet" href="{% static 'layui2/css/layui.css'%}"  media="all">
    <script src="{% static 'layui2/layui.js'%}" charset="utf-8"></script>
    <script src="{% static 'js/js.cookies.js'%}" charset="utf-8"></script>
    <style type="text/css">
        #mynetwork2 {
            width: 800px;
            height: 600px;
            border: 1px solid lightgray;
        }
    </style>
    <script type="text/javascript" src="{% static 'vis/vis.min.js'%}"></script>
    <script type="text/javascript" src="{% static 'vis/vis.js'%}"></script>
    <link href="{% static 'vis/vis-network.min.css'%}" rel="stylesheet" type="text/css">
<!--自定义js-->
    <script src="{% static 'js/tableOperation.js'%}"></script>
    <script src="{% static 'js/formOperation.js'%}"></script>
    <script src="{% static 'js/referenceAction.js'%}"></script>
    <style type="text/css">
        .small-font { font-size: 1.5vw;}
        .collapse-disable {transition: none !important;}
    </style>
</head>
<body>
<!--选择数据库-->
    <div class="container-fluid row">
        <div class="col-sm-12 col-md-12">
            <form class="layui-form" action="">
                <div class="layui-inline">
                    <label class="layui-form-item">选择数据库</label>
                    <div class="layui-input-inline">
                        <div class="layui-input-inline">
                            <select name="modules" lay-verify="required" lay-search="">
                                <option value="">数据库名称</option>
                                <option value="1">CPWL</option>
                                <option value="2">form</option>
                            </select>
                        </div>
                        <div class="layui-input-inline">
                            <button class="layui-btn" lay-submit="" lay-filter="getDatabase">获取数据</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>


    </div>
    <!--选项卡-->
    <div class="layui-tab layui-tab-card">
        <ul class="layui-tab-title">
            <li class="layui-this">数据库详情</li>
            <li>查看/修改数据</li>
            <li>新增数据</li>
            <li>数据显示</li>
            <li></li>
        </ul>
        <div class="layui-tab-content">
            <!--1。数据库详情-->
            <div class="layui-tab-item layui-show">
                <p>还未实现</p>

            </div>
            <!--2.查看数据-->
            <div class="layui-tab-item">
                <div class="layui-tab layui-tab-card">
                    <ul class="layui-tab-title">
                        <li class="layui-this">文献</li>
                        <li>人</li>
                        <li>Venue</li>
                        <li>关系</li>
                    </ul>
                    <div class="layui-tab-content">
                        <!--文献-->
                        <div class="layui-tab-item layui-show">
                            <!--高级搜搜框-->
                            <div id="advanceSearch" class="collapse in" style="border:1px solid #000;margin-top:10px;margin-bottom:10px">
                                <form class="layui-form" action="">
                                    <!--标题-->
                                    <div class="layui-form-item">
                                        <label class="layui-form-label" style="width:100px">标题</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="title" required  lay-verify="required" placeholder="请输入关键字，以逗号分隔" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--时间范围-->
                                    <div class="layui-form-item">
                                        <label class="layui-form-label" style="width:100px">时间范围</label>
                                        <div class="layui-input-inline" style="margin-left:10px">
                                            <input id="startTime" type="text" name="startTime"  placeholder="From" autocomplete="off" class="layui-input">
                                        </div>
                                        <div class="layui-form-mid layui-word-aux">-</div>
                                        <div class="layui-input-inline">
                                            <input id="endTime" type="text" name="endTime" placeholder="To" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--作者-->
                                    <div class="layui-form-item">
                                        <label class="layui-form-label" style="width:100px">作者</label>
                                        <div class="layui-input-block">
                                            <input id="searchPubAuthor" type="text" name="searchPubAuthor" placeholder="作者（用英文逗号分开）" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--文章索引-->
                                    <div class="layui-form-item">
                                        <label class="layui-form-label" style="width:100px">文章索引</label>
                                        <div class="layui-input-block">
                                            <select name="paperIndexing" multiple>
                                                <option value="">不指定</option>
                                                <option value="0">EI</option>
                                                <option value="1">SCI</option>
                                                <option value="2">SSCI</option>
                                            </select>
                                        </div>
                                    </div>
                                    <!--文章类型-->
                                    <div class="layui-form-item">
                                        <label class="layui-form-label" style="width:100px">文章类型</label>
                                        <div class="layui-input-block">
                                            <select name="paperType" multiple>
                                                <option value="">不指定</option>
                                                <option value="0">Article</option>
                                                <option value="1">Conference</option>
                                                <option value="2">InPeoceedings</option>
                                                <option value="3">Book</option>
                                                <option value="4">InBook</option>
                                                <option value="5">InCollection</option>
                                                <option value="6">Masters Thesis</option>
                                                <option value="7">PhD Thesis</option>
                                                <option value="8">Technical Report</option>
                                            </select>
                                        </div>
                                    </div>
                                    <!--按钮建-->
                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <button class="layui-btn" lay-submit lay-filter="searchPub">搜索</button>
                                            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <!--搜索结果表格-->
                            <div id="queriedPubsDiv" class="collapse" style="border:1px solid #000;margin-top:10px;margin-bottom:10px">
                                <table class="layui-hide" id="pubTableAfterSearch" lay-filter="pubTableAfterSearch"></table>
                            </div>
                            <!--文献编辑表单-->
                            <div id="editPub" class="collapse" style="border:1px solid #000;margin-top:10px;margin-bottom:10px">
                                <form class="layui-form" action="" lay-filter="editPubPanel" id="editPubForm">
                                    <!--文献类型-->
                                    <div class="layui-form-item" id="editPub-pubType">
                                        <label class="layui-form-label" style="width:100px">文献类型</label>
                                        <div class="layui-input-block">
                                            <select name="paperTypeEdit" lay-filter="paperTypeEdit" lay-verify="required">
                                                <option value="0">Article</option>
                                                <option value="1">Book</option>
                                                <option value="2">Booklet</option>
                                                <option value="3">Conference</option>
                                                <option value="4">InBook</option>
                                                <option value="5">InCollection</option>
                                                <option value="6">InProceedings</option>
                                                <option value="7">Manual</option>
                                                <option value="8">MastersThesis</option>
                                                <option value="9">Misc</option>
                                                <option value="10">PhDThesis</option>
                                                <option value="11">Proceedings</option>
                                                <option value="12">TechReport</option>
                                                <option value="13">Unpublished</option>
                                            </select>
                                        </div>
                                    </div>
                                    <!--标题-->
                                    <div class="layui-form-item" id="editPub-title" style="display:auto">
                                        <label class="layui-form-label" style="width:100px">Title</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="title" placeholder="Title" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--book标题-->
                                    <div class="layui-form-item" id="editPub-book_title" style="display:none">
                                        <label class="layui-form-label" style="width:100px">Book Title</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="book_title" placeholder="Book Title" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--editor-->
                                    <div class="layui-form-item" id="editPub-editor" style="display:none">
                                        <label class="layui-form-label" style="width:100px">Editor</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="editor" placeholder="Editor" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--keywords-->
                                    <div class="layui-form-item" id="editPub-keywords" style="display:none">
                                        <label class="layui-form-label" style="width:100px">Keywords</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="keywords" placeholder="Keywords" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--edition-->
                                    <div class="layui-form-item" id="editPub-edition" style="display:none">
                                        <label class="layui-form-label" style="width:100px">Edition</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="edition" placeholder="Edition" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--作者(表格)-->
                                    <div class="layui-form-item" id="editPub-author" style="display:auto">
                                        <label class="layui-form-label" style="width:100px;margin-right:10px" >Authors</label>
                                        <div class="layui-input-block ">
                                            <script type="text/html" id="authorBarsEdit">
                                                <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="addAuthorEdit" data-type="reload">新增</a>
                                                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delAuthorEdit">删除</a>
                                            </script>

                                            <table class="layui-hide" id="authorTableEdit" lay-filter="demoEdit" name="author"></table>
                                        </div>
                                    </div>
                                    <!--year-->
                                    <div class="layui-form-item" id="editPub-year" style="display:auto">
                                        <label class="layui-form-label" style="width:100px">Year</label>
                                        <div class="layui-input-inline" style="margin-left:10px">
                                            <input id="pubYearEdit" type="text" name="year" lay-veryfy="date"  placeholder="Year" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--month-->
                                    <div class="layui-form-item" id="editPub-month" style="display:auto">
                                        <label class="layui-form-label" style="width:100px">Month</label>
                                        <div class="layui-input-inline" style="margin-left:10px">
                                            <input id="pubMonthEdit" type="text" name="month" lay-veryfy="date"  placeholder="Month" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--venue title-->
                                    <div class="layui-form-item" id="editPub-journal" style="display:auto">
                                        <label class="layui-form-label" style="width:100px">Journal</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="journal" placeholder="Journal" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--volume-->
                                    <div class="layui-form-item" id="editPub-volume" style="display:auto">
                                        <label class="layui-form-label" style="width:100px">Volume</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="volume" placeholder="Volume" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--type-->
                                    <div class="layui-form-item" id="editPub-type" style="display:none">
                                        <label class="layui-form-label" style="width:100px">Type</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="type" placeholder="Type" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--chapter-->
                                    <div class="layui-form-item" id="editPub-chapter" style="display:none">
                                        <label class="layui-form-label" style="width:100px">Chapter</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="chapter" placeholder="Chapter" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--number-->
                                    <div class="layui-form-item" id="editPub-number" style="display:auto">
                                        <label class="layui-form-label" style="width:100px">Number</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="number" placeholder="Number" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--pages-->
                                    <div class="layui-form-item" id="editPub-pages" style="display:auto">
                                        <label class="layui-form-label" style="width:100px">Pages</label>
                                        <div class="layui-input-inline" style="margin-left:10px">
                                            <input type="text" name="pages1" placeholder="From" autocomplete="off" class="layui-input">
                                        </div>
                                        <div class="layui-form-mid">
                                            -
                                        </div>
                                        <div class="layui-input-inline">
                                            <input type="text" name="pages2" placeholder="To" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--publisher-->
                                    <div class="layui-form-item" id="editPub-publisher" style="display:none">
                                        <label class="layui-form-label" style="width:100px">Publisher</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="publisher" placeholder="Publisher" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--organization-->
                                    <div class="layui-form-item" id="editPub-organization" style="display:none">
                                        <label class="layui-form-label" style="width:100px">Organization</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="organization" placeholder="Organization" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--institution-->
                                    <div class="layui-form-item" id="editPub-institution" style="display:none">
                                        <label class="layui-form-label" style="width:100px">Institution</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="institution" placeholder="Institution" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--school-->
                                    <div class="layui-form-item" id="editPub-school" style="display:none">
                                        <label class="layui-form-label" style="width:100px">School</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="school" placeholder="School" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--publisher addr-->
                                    <div class="layui-form-item" id="editPub-address" style="display:none">
                                        <label class="layui-form-label" style="width:100px">Publisher's Address</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="address" placeholder="Address" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--series-->
                                    <div class="layui-form-item" id="editPub-series" style="display:none">
                                        <label class="layui-form-label" style="width:100px">Series</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="series" placeholder="Series" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--how_published-->
                                    <div class="layui-form-item" id="editPub-how_published" style="display:none">
                                        <label class="layui-form-label" style="width:100px">How Published</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="how_published" placeholder="How Published" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--文章索引-->
                                    <div class="layui-form-item" id="editPub-indexed" style="display:auto">
                                        <label class="layui-form-label" style="width:100px">Indexing</label>
                                        <div class="layui-input-block">
                                            <select name="indexing" >
                                                <option value="">必填</option>
                                                <option value="0">EI</option>
                                                <option value="1">SCI</option>
                                                <option value="2">SSCI</option>
                                                <option value="3">其他</option>
                                            </select>
                                        </div>
                                    </div>
                                    <!--note-->
                                    <div class="layui-form-item" id="editPub-note" style="display:auto">
                                        <label class="layui-form-label" style="width:100px">Note</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="note" placeholder="Note" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--按钮建-->
                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <button class="layui-btn" lay-submit lay-filter="editPubSubmit">提交</button>
                                            <button class="layui-btn layui-btn-primary" lay-submit lay-filter="cancelEditPubPanel">取消</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <!--人-->
                        <div class="layui-tab-item">
                            <!--高级搜搜框-->
                            <div id="advanceSearchPerson" class="collapse in" style="border:1px solid #000;margin-top:10px;margin-bottom:10px">
                                <form class="layui-form" action="">
                                    <!--全名-->
                                    <div class="layui-form-item" id="queriedPerson-fullname">
                                        <label class="layui-form-label" style="width:100px">Full Name</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="full_name" placeholder="Full Name" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--Chinese Name-->
                                    <div class="layui-form-item" id="queriedPerson-name_ch">
                                        <label class="layui-form-label" style="width:100px">中文名</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="name_ch" placeholder="中文名" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--Institution-->
                                    <div class="layui-form-item" id="queriedPerson-institution">
                                        <label class="layui-form-label" style="width:100px">Institution</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="institution" placeholder="Institution" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--研究兴趣-->
                                    <div class="layui-form-item" id="queriederson-research_interest">
                                        <label class="layui-form-label" style="width:100px;margin-right:10px" >Authors</label>
                                        <div class="layui-input-block ">
                                            <input type="text" name="research_interest" placeholder="Research Interest" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--按钮建-->
                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <button class="layui-btn" lay-submit lay-filter="searchPerson">提交</button>
                                            <button type="reset" class="layui-btn layui-btn-primary" lay-submit lay-filter="resetSearchPersonPanel">重置</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <!--搜索结果表格-->
                            <div id="queriedPersonsDiv" class="collapse" style="border:1px solid #000;margin-top:10px;margin-bottom:10px">
                                <table class="layui-hide" id="personTableAfterSearch" lay-filter="personTableAfterSearch"></table>
                            </div>
                            <!--ren编辑表单-->
                            <div id="editPerson" class="collapse" style="border:1px solid #000;margin-top:10px;margin-bottom:10px">
                                <form class="layui-form" action="" lay-filter="editPersonPanel" id="editPersonForm">
                                    <!--全名-->
                                    <div class="layui-form-item" id="editPerson-fullname">
                                        <label class="layui-form-label" style="width:100px">Full Name</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="full_name" placeholder="Full Name" autocomplete="off" class="layui-input" id="full_name_edit">
                                        </div>
                                    </div>
                                    <!--名-->
                                    <div class="layui-form-item" id="editPerson-first_name">
                                        <label class="layui-form-label" style="width:100px">First Name</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="first_name" placeholder="First Name" autocomplete="off" class="layui-input" id="first_name_edit">
                                        </div>
                                    </div>
                                    <!--Middle Name-->
                                    <div class="layui-form-item" id="editPerson-middle_name">
                                        <label class="layui-form-label" style="width:100px">Middle Name</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="middle_name" placeholder="Middle Name" autocomplete="off" class="layui-input" id="middle_name_edit">
                                        </div>
                                    </div>
                                    <!--Last Name-->
                                    <div class="layui-form-item" id="editPerson-last_name">
                                        <label class="layui-form-label" style="width:100px">Last Name</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="last_name" placeholder="Last Name" autocomplete="off" class="layui-input" id="last_name_edit">
                                        </div>
                                    </div>
                                    <!--Chinese Name-->
                                    <div class="layui-form-item" id="editPerson-name_ch">
                                        <label class="layui-form-label" style="width:100px">中文名</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="name_ch" placeholder="中文名" autocomplete="off" class="layui-input" id="name_ch_edit">
                                        </div>
                                    </div>
                                    <!--姓（中文）-->
                                    <div class="layui-form-item" id="editPerson-last_name_ch">
                                        <label class="layui-form-label" style="width:100px">姓-</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="last_name_ch" placeholder="姓" autocomplete="off" class="layui-input" id="last_name_ch_edit">
                                        </div>
                                    </div>
                                    <!--名（中文）-->
                                    <div class="layui-form-item" id="editPerson-first_name_ch">
                                        <label class="layui-form-label" style="width:100px">名</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="first_name_ch" placeholder="名" autocomplete="off" class="layui-input" id="first_name_ch_edit">
                                        </div>
                                    </div>
                                    <!--Institution-->
                                    <div class="layui-form-item" id="editPerson-institution">
                                        <label class="layui-form-label" style="width:100px">Institution</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="institution" placeholder="Institution" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--研究兴趣-->
                                    <div class="layui-form-item" id="editPerson-research_interest" style="display:auto">
                                        <label class="layui-form-label" style="width:100px;margin-right:10px" >Authors</label>
                                        <div class="layui-input-block ">
                                            <input type="text" name="research_interest" placeholder="Research Interest" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>

                                    <!--note-->
                                    <div class="layui-form-item" id="editPerson-note">
                                        <label class="layui-form-label" style="width:100px">Note</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="note" placeholder="Note" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--按钮建-->
                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <button class="layui-btn" lay-submit lay-filter="editPersonSubmit">提交</button>
                                            <button type="reset" class="layui-btn layui-btn-primary" lay-submit lay-filter="cancelEditPersonPanel">取消</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <!--Venue-->
                        <div class="layui-tab-item">
                            <!--高级搜搜框-->
                            <div id="advanceSearchVenue" class="collapse in" style="border:1px solid #000;margin-top:10px;margin-bottom:10px">
                                <form class="layui-form" action="">
                                    <!--Venue Name-->
                                    <div class="layui-form-item" id="queriedVenue-venue_name">
                                        <label class="layui-form-label" style="width:100px">Venue Name</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="venue_name" placeholder="Venue Name" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--Abbr-->
                                    <div class="layui-form-item" id="queriedVenue-abbr">
                                        <label class="layui-form-label" style="width:100px">Abbr.</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="abbr" placeholder="Abbr" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--publisher-->
                                    <div class="layui-form-item" id="queriedVenue-publisher">
                                        <label class="layui-form-label" style="width:100px">Publisher</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="publisher" placeholder="Publisher" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--start_year-->
                                    <div class="layui-form-item" id="queriedVenue-start_year">
                                        <label class="layui-form-label" style="width:100px">Start Year</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="start_year" placeholder="Start Year" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--venue_type-->
                                    <div class="layui-form-item" id="queriedVenue-venue_type">
                                        <label class="layui-form-label" style="width:100px">Venue Type</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="venue_type" placeholder="venue type" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--Indexing-->
                                    <div class="layui-form-item" id="queriedVenue-indexing">
                                        <label class="layui-form-label" style="width:100px;margin-right:10px" >Indexing</label>
                                        <div class="layui-input-block">
                                            <select name="indexing" multiple>
                                                <option value="">其他</option>
                                                <option value="0">EI</option>
                                                <option value="1">SCI</option>
                                                <option value="2">SSCI</option>
                                            </select>
                                        </div>
                                    </div>
                                    <!--按钮建-->
                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <button class="layui-btn" lay-submit lay-filter="searchVenue">提交</button>
                                            <button type="reset" class="layui-btn layui-btn-primary" lay-submit lay-filter="resetSearchVenuePanel">重置</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <!--搜索结果表格-->
                            <div id="queriedVenueDiv" class="collapse" style="border:1px solid #000;margin-top:10px;margin-bottom:10px">
                                <table class="layui-hide" id="venueTableAfterSearch" lay-filter="venueTableAfterSearch"></table>
                            </div>
                            <!--文献编辑表单-->
                            <div id="editVenue" class="collapse" style="border:1px solid #000;margin-top:10px;margin-bottom:10px">
                                <form class="layui-form" action="" lay-filter="editVenuePanel" id="editVenueForm">
                                    <!--Venue Name-->
                                    <div class="layui-form-item" id="editVenue-venue_name">
                                        <label class="layui-form-label" style="width:100px">Venue Name</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="venue_name" placeholder="Venue Name" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--Abbr-->
                                    <div class="layui-form-item" id="editVenue-abbr">
                                        <label class="layui-form-label" style="width:100px">Abbr.</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="abbr" placeholder="Abbr" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--venue_type-->
                                    <div class="layui-form-item" id="editVenue-venue_type">
                                        <label class="layui-form-label" style="width:100px">Venue Type</label>
                                        <div class="layui-input-block">
                                            <select name="venue_type" lay-filter="paperTypeEdit" lay-verify="required">
                                                <option value="">venue type</option>
                                                <option value="0">Article</option>
                                                <option value="1">Book</option>
                                                <option value="2">Booklet</option>
                                                <option value="3">Conference</option>
                                                <option value="4">InBook</option>
                                                <option value="5">InCollection</option>
                                                <option value="6">InProceedings</option>
                                                <option value="7">Manual</option>
                                                <option value="8">MastersThesis</option>
                                                <option value="9">Misc</option>
                                                <option value="10">PhDThesis</option>
                                                <option value="11">Proceedings</option>
                                                <option value="12">TechReport</option>
                                                <option value="13">Unpublished</option>
                                            </select>
                                        </div>
                                    </div>
                                    <!--publisher-->
                                    <div class="layui-form-item" id="editVenue-publisher">
                                        <label class="layui-form-label" style="width:100px">Publisher</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="publisher" placeholder="Publisher" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--address-->
                                    <div class="layui-form-item" id="editVenue-address">
                                        <label class="layui-form-label" style="width:100px">Address</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="address" placeholder="Address" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--start_year-->
                                    <div class="layui-form-item" id="editVenue-start_year">
                                        <label class="layui-form-label" style="width:100px">Start Year</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="start_year" placeholder="Start Year" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--Indexing-->
                                    <div class="layui-form-item" id="editVenue-indexing">
                                        <label class="layui-form-label" style="width:100px;margin-right:10px" >Indexing</label>
                                        <div class="layui-input-block">
                                            <select name="indexing" multiple>
                                                <option value="">其他</option>
                                                <option value="0">EI</option>
                                                <option value="1">SCI</option>
                                                <option value="2">SSCI</option>
                                            </select>
                                        </div>
                                    </div>
                                    <!--note-->
                                    <div class="layui-form-item" id="editVenue-note">
                                        <label class="layui-form-label" style="width:100px">Note</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="note" placeholder="Note" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--按钮建-->
                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <button class="layui-btn" lay-submit lay-filter="editVenueSubmit">提交</button>
                                            <button type="reset" class="layui-btn layui-btn-primary" lay-submit lay-filter="cancelEditVenuePanel">取消</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <!--Relation-->
                        <div class="layui-tab-item">
                            未实现
                        </div>
                    </div>
                </div>
            </div>
            <!--3。新增数据-->
            <div class="layui-tab-item">
                <div class="layui-tab layui-tab-card">
                    <ul class="layui-tab-title">
                        <li class="layui-this">文献</li>
                        <li>人</li>
                        <li>Venue</li>
                        <li>关系</li>
                    </ul>
                    <div class="layui-tab-content">
                        <!--子面板：新增文献-->
                        <div class="layui-tab-item layui-show">
                            <form class="layui-form collaspe in" action="">
                                <!--文献添加方式按钮-->
                                <div class="layui-form-item">
                                    <label class="layui-form-label" style="margin-right:20px;width:100px">添加方式</label>
                                    <div class="layui-input-block">
                                        <input type="checkbox" name="addPubWay" checked lay-skin="switch" lay-filter="addPubWay" lay-text="手动添加单条记录|上传bib文件">
                                    </div>
                                </div>
                                <!--上传文献框/文献字段编辑框-->
                                <div class="layui-form-item" style="border:1px solid #000">
                                    <div id="uploadBib" class="layui-upload collapse">
                                        <button type="button" class="layui-btn layui-btn-normal" id="chooseBibFile">选择bib文件</button>
                                        <div class="layui-upload-list">
                                            <table class="layui-table">
                                                <thead>
                                                <tr><th>文件名</th>
                                                <th>大小</th>
                                                <th>状态</th>
                                                <th>操作</th>
                                                </tr></thead>
                                                <tbody id="demoList"></tbody>
                                            </table>
                                        </div>
                                        <button type="button" class="layui-btn" id="testListAction">开始上传</button>
                                    </div>
                                    <div id="addPub" class="collapse in">
                                        <form class="layui-form" action="" lay-filter="addOrEditPubPanel">
                                            <!--文献类型-->
                                            <div class="layui-form-item" id="addPub-pubType">
                                                <label class="layui-form-label" style="width:100px">文献类型</label>
                                                <div class="layui-input-block">
                                                    <select name="paperTypeEdit" lay-filter="paperTypeAdd" lay-verify="required">
                                                        <option value="0">Article</option>
                                                        <option value="1">Book</option>
                                                        <option value="2">Booklet</option>
                                                        <option value="3">Conference</option>
                                                        <option value="4">InBook</option>
                                                        <option value="5">InCollection</option>
                                                        <option value="6">InProceedings</option>
                                                        <option value="7">Manual</option>
                                                        <option value="8">MastersThesis</option>
                                                        <option value="9">Misc</option>
                                                        <option value="10">PhDThesis</option>
                                                        <option value="11">Proceedings</option>
                                                        <option value="12">TechReport</option>
                                                        <option value="13">Unpublished</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <!--标题-->
                                            <div class="layui-form-item" id="addPub-title" style="display:auto">
                                                <label class="layui-form-label" style="width:100px">Title</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="title" placeholder="Title" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--book标题-->
                                            <div class="layui-form-item" id="addPub-book_title" style="display:none">
                                                <label class="layui-form-label" style="width:100px">Book Title</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="book_title" placeholder="Book Title" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--editor-->
                                            <div class="layui-form-item" id="addPub-editor" style="display:none">
                                                <label class="layui-form-label" style="width:100px">Editor</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="editor" placeholder="Editor" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--keywords-->
                                            <div class="layui-form-item" id="addPub-keywords" style="display:none">
                                                <label class="layui-form-label" style="width:100px">Keywords</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="keywords" placeholder="Keywords" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--edition-->
                                            <div class="layui-form-item" id="addPub-edition" style="display:none">
                                                <label class="layui-form-label" style="width:100px">Edition</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="edition" placeholder="Edition" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--作者(表格)-->
                                            <div class="layui-form-item" id="addPub-author" style="display:auto">
                                                <label class="layui-form-label" style="width:100px;margin-right:10px" >Authors</label>
                                                <div class="layui-input-block ">
                                                    <script type="text/html" id="authorBarsAdd">
                                                        <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="addAuthor" data-type="reload">新增</a>
                                                        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delAuthor">删除</a>
                                                    </script>

                                                    <table class="layui-hide" id="authorTableAdd" lay-filter="demo" name="author"></table>
                                                </div>
                                            </div>
                                            <!--year-->
                                            <div class="layui-form-item" id="addPub-year" style="display:auto">
                                                <label class="layui-form-label" style="width:100px">Year</label>
                                                <div class="layui-input-inline" style="margin-left:10px">
                                                    <input id="pubYearAdd" type="text" name="year" lay-veryfy="date"  placeholder="Year" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--month-->
                                            <div class="layui-form-item" id="addPub-month" style="display:auto">
                                                <label class="layui-form-label" style="width:100px">Month</label>
                                                <div class="layui-input-inline" style="margin-left:10px">
                                                    <input id="pubMonthAdd" type="text" name="month" lay-veryfy="date"  placeholder="Month" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--venue title-->
                                            <div class="layui-form-item" id="addPub-journal" style="display:auto">
                                                <label class="layui-form-label" style="width:100px">Journal</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="journal" placeholder="Journal" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--volume-->
                                            <div class="layui-form-item" id="addPub-volume" style="display:auto">
                                                <label class="layui-form-label" style="width:100px">Volume</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="volume" placeholder="Volume" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--type-->
                                            <div class="layui-form-item" id="addPub-type" style="display:none">
                                                <label class="layui-form-label" style="width:100px">Type</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="type" placeholder="Type" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--chapter-->
                                            <div class="layui-form-item" id="addPub-chapter" style="display:none">
                                                <label class="layui-form-label" style="width:100px">Chapter</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="chapter" placeholder="Chapter" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--number-->
                                            <div class="layui-form-item" id="addPub-number" style="display:auto">
                                                <label class="layui-form-label" style="width:100px">Number</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="number" placeholder="Number" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--pages-->
                                            <div class="layui-form-item" id="addPub-pages" style="display:auto">
                                                <label class="layui-form-label" style="width:100px">Pages</label>
                                                <div class="layui-input-inline" style="margin-left:10px">
                                                    <input type="text" name="pages1" placeholder="From" autocomplete="off" class="layui-input">
                                                </div>
                                                <div class="layui-form-mid">
                                                    -
                                                </div>
                                                <div class="layui-input-inline">
                                                    <input type="text" name="pages2" placeholder="To" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--publisher-->
                                            <div class="layui-form-item" id="addPub-publisher" style="display:none">
                                                <label class="layui-form-label" style="width:100px">Publisher</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="publisher" placeholder="Publisher" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--organization-->
                                            <div class="layui-form-item" id="addPub-organization" style="display:none">
                                                <label class="layui-form-label" style="width:100px">Organization</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="organization" placeholder="Organization" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--institution-->
                                            <div class="layui-form-item" id="addPub-institution" style="display:none">
                                                <label class="layui-form-label" style="width:100px">Institution</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="institution" placeholder="Institution" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--school-->
                                            <div class="layui-form-item" id="addPub-school" style="display:none">
                                                <label class="layui-form-label" style="width:100px">School</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="school" placeholder="School" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--publisher addr-->
                                            <div class="layui-form-item" id="addPub-address" style="display:none">
                                                <label class="layui-form-label" style="width:100px">Publisher's Address</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="address" placeholder="Address" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--series-->
                                            <div class="layui-form-item" id="addPub-series" style="display:none">
                                                <label class="layui-form-label" style="width:100px">Series</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="series" placeholder="Series" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--how_published-->
                                            <div class="layui-form-item" id="addPub-how_published" style="display:none">
                                                <label class="layui-form-label" style="width:100px">How Published</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="how_published" placeholder="How Published" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--文章索引-->
                                            <div class="layui-form-item" id="addPub-indexed" style="display:auto">
                                                <label class="layui-form-label" style="width:100px">Indexing</label>
                                                <div class="layui-input-block">
                                                    <select name="indexing" >
                                                        <option value="">必填</option>
                                                        <option value="0">EI</option>
                                                        <option value="1">SCI</option>
                                                        <option value="2">SSCI</option>
                                                        <option value="3">其他</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <!--note-->
                                            <div class="layui-form-item" id="addPub-note" style="display:auto">
                                                <label class="layui-form-label" style="width:100px">Note</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="note" placeholder="Note" autocomplete="off" class="layui-input">
                                                </div>
                                            </div>
                                            <!--按钮建-->
                                            <div class="layui-form-item">
                                                <div class="layui-input-block">
                                                    <button class="layui-btn" lay-submit lay-filter="newPubSubmit">提交</button>
                                                    <button type="reset" class="layui-btn layui-btn-primary" lay-submit lay-filter="resetAddPubPanel">重置</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <!--字面板：新增人-->
                        <div class="layui-tab-item">
                            <form class="layui-form" action="" lay-filter="addPerson">
                                <!--全名-->
                                <div class="layui-form-item" id="addPerson-fullname">
                                    <label class="layui-form-label" style="width:100px">Full Name</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="full_name" placeholder="Full Name" autocomplete="off" class="layui-input" id="full_name_en">
                                    </div>
                                </div>
                                <!--名-->
                                <div class="layui-form-item" id="addPerson-first_name">
                                    <label class="layui-form-label" style="width:100px">First Name</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="first_name" placeholder="First Name" autocomplete="off" class="layui-input" id="first_en">
                                    </div>
                                </div>
                                <!--Middle Name-->
                                <div class="layui-form-item" id="addPerson-middle_name">
                                    <label class="layui-form-label" style="width:100px">Middle Name</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="middle_name" placeholder="Middle Name" autocomplete="off" class="layui-input" id="mid_en">
                                    </div>
                                </div>
                                <!--Last Name-->
                                <div class="layui-form-item" id="addPerson-last_name">
                                    <label class="layui-form-label" style="width:100px">Last Name</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="last_name" placeholder="Last Name" autocomplete="off" class="layui-input" id="last_en">
                                    </div>
                                </div>
                                <!--Chinese Name-->
                                <div class="layui-form-item" id="addPerson-name_ch">
                                    <label class="layui-form-label" style="width:100px">中文名</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="name_ch" placeholder="中文名" autocomplete="off" class="layui-input" id="full_name_ch">
                                    </div>
                                </div>
                                <!--姓（中文）-->
                                <div class="layui-form-item" id="addPerson-last_name_ch">
                                    <label class="layui-form-label" style="width:100px">姓-</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="last_name_ch" placeholder="姓" autocomplete="off" class="layui-input" id="last_ch">
                                    </div>
                                </div>
                                <!--名（中文）-->
                                <div class="layui-form-item" id="addPerson-first_name_ch">
                                    <label class="layui-form-label" style="width:100px">名</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="first_name_ch" placeholder="名" autocomplete="off" class="layui-input" id="first_ch">
                                    </div>
                                </div>
                                <!--Institution-->
                                <div class="layui-form-item" id="addPerson-institution">
                                    <label class="layui-form-label" style="width:100px">Institution</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="institution" placeholder="Institution" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <!--研究兴趣-->
                                <div class="layui-form-item" id="addPerson-research_interest" style="display:auto">
                                    <label class="layui-form-label" style="width:100px;margin-right:10px" >Research Interest</label>
                                    <div class="layui-input-block ">
                                        <input type="text" name="research_interest" placeholder="Research Interest" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <!--note-->
                                <div class="layui-form-item" id="addPerson-note">
                                    <label class="layui-form-label" style="width:100px">Note</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="note" placeholder="Note" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <!--按钮建-->
                                <div class="layui-form-item">
                                    <div class="layui-input-block">
                                        <button class="layui-btn" lay-submit lay-filter="newPersonSubmit">提交</button>
                                        <button type="reset" class="layui-btn layui-btn-primary" lay-submit lay-filter="resetAddPersonPanel">重置</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <!--子面板：新增期刊-->
                        <div class="layui-tab-item">
                            <form class="layui-form" action="" lay-filter="addVenue">
                                <!--Venue Name-->
                                <div class="layui-form-item" id="addVenue-venue_name">
                                    <label class="layui-form-label" style="width:100px">Venue Name</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="venue_name" placeholder="Venue Name" autocomplete="off" class="layui-input" id="venue_name_en">
                                    </div>
                                </div>
                                <!--Abbr-->
                                <div class="layui-form-item" id="addVenue-abbr">
                                    <label class="layui-form-label" style="width:100px">Abbr.</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="abbr" placeholder="Abbr" autocomplete="off" class="layui-input" id="venue_abbr">
                                    </div>
                                </div>
                                <!--venue_type-->
                                <div class="layui-form-item" id="addVenue-venue_type">
                                    <label class="layui-form-label" style="width:100px">Venue Type</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="venue_type" placeholder="venue type" autocomplete="off" class="layui-input" id="venue_type">
                                    </div>
                                </div>
                                <!--publisher-->
                                <div class="layui-form-item" id="addVenue-publisher">
                                    <label class="layui-form-label" style="width:100px">Publisher</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="publisher" placeholder="Publisher" autocomplete="off" class="layui-input" id="venue_publisher">
                                    </div>
                                </div>
                                <!--address-->
                                <div class="layui-form-item" id="addVenue-address">
                                    <label class="layui-form-label" style="width:100px">Address</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="address" placeholder="Address" autocomplete="off" class="layui-input" id="venue_address">
                                    </div>
                                </div>
                                <!--start_year-->
                                <div class="layui-form-item" id="addVenue-start_year">
                                    <label class="layui-form-label" style="width:100px">Start Year</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="start_year" placeholder="Start Year" autocomplete="off" class="layui-input" id="venue_start_year">
                                    </div>
                                </div>
                                <!--Indexing-->
                                <div class="layui-form-item" id="addVenue-indexing">
                                    <label class="layui-form-label" style="width:100px;margin-right:10px" >Indexing</label>
                                    <div class="layui-input-block">
                                        <select name="indexing" multiple>
                                            <option value="">其他</option>
                                            <option value="0">EI</option>
                                            <option value="1">SCI</option>
                                            <option value="2">SSCI</option>
                                        </select>
                                    </div>
                                </div>
                                <!--note-->
                                <div class="layui-form-item" id="addVenue-note">
                                    <label class="layui-form-label" style="width:100px">Note</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="note" placeholder="Note" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <!--按钮建-->
                                <div class="layui-form-item">
                                    <div class="layui-input-block">
                                        <button class="layui-btn" lay-submit lay-filter="newVenueSubmit">提交</button>
                                        <button type="reset" class="layui-btn layui-btn-primary" lay-submit lay-filter="resetAddVenuePanel">重置</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <!--子面板：新增关系-->
                        <div class="layui-tab-item">
                            <form class="layui-form" action="">
                                <!--关系选择下拉菜单-->
                                <div class="layui-form-item">
                                    <label class="layui-form-label" style="width:100px">关系类型</label>
                                    <div class="layui-input-block">
                                        <select name="relation_type" lay-filter="relation_type_select" id="relation_type_select">
                                            <option value="">选择关系关系类型</option>
                                            <option value="0">Paper Published In Venue</option>
                                            <option value="1">Person Write Paper</option>
                                            <option value="2">Paper Cite Pater</option>
                                        </select>
                                    </div>
                                </div>
                                <!--起讫点选择-->
                                <div class="layui-form-item collapse" id="addRelSourcceTarget">
                                    <label class="layui-form-label" style="width:100px">起讫点</label>
                                    <div class="layui-input-block">
                                        <button id="relSource" class="layui-btn layui-btn-radius layui-btn-normal" style="margin-right:100px" lay-submit lay-filter="relSource">Venue</button>
                                        <button id="relTarget" class="layui-btn layui-btn-radius layui-btn-warm" style="margin-left:100px" lay-submit lay-filter="relTarget">Paper</button>
                                    </div>
                                </div>
                                <!--选择点信息展示-->
                                <div class="layui-form-item collapse" id="addRelInfoDiv">
                                    <div class="layui-row">
                                        <div class="layui-col-xs4 layui-col-sm12 layui-col-md4" style="min-width:100px">
                                            <pre id="addRelSourceInfo"></pre>
                                        </div>
                                        <div class="layui-col-xs4 layui-col-sm7 layui-col-md8" style="min-width:100px">
                                            <pre id="addRelInfo"></pre>
                                        </div>
                                        <div class="layui-col-xs4 layui-col-sm5 layui-col-md4" style="min-width:100px">
                                            <pre id="addRelTargetInfo"></pre>
                                        </div>
                                    </div>
                                </div>
                                <!--确认按钮-->
                                <div class="layui-form-item collapse" id="addRelConfirm">
                                    <div class="layui-input-block" style="position:relative;left:30%;">
                                        <button id="relConfirm" class="layui-btn layui-btn-radius layui-btn-normal" lay-submit lay-filter="relConfirm">Confirm</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!--5。查询展示数据结果-->
            <div class="layui-tab-item">
                <!--查询语句-->
                <p>还未实现</p>
            </div>
        </div>
    </div>

    <script type="text/html" id="toolbarEditPubGetData">
        <div class="layui-btn-container">
            <button class="layui-btn layui-btn-sm" lay-event="getCheckData">编辑选中文献数据</button>
        </div>
    </script>

    <script type="text/html" id="toolbarEditPersonGetData">
        <div class="layui-btn-container">
            <button class="layui-btn layui-btn-sm" lay-event="getCheckData">编辑选中人员信息</button>
        </div>
    </script>

    <script type="text/html" id="toolbarEditVenueGetData">
        <div class="layui-btn-container">
            <button class="layui-btn layui-btn-sm" lay-event="getCheckData">编辑选中Venue数据</button>
        </div>
    </script>

    <script type="text/html" id="toolbarPopUpGetData">
        <div class="layui-btn-container">
            <button class="layui-btn layui-btn-sm" lay-event="getCheckData">选择</button>
        </div>
    </script>

    <script>
        //关于显示上传按钮还是手动输入文献的控件
        layui.use('form', function(){
            var form = layui.form
                ,$ = layui.$;
            form.on('switch(addPubWay)', function(data){
                var collapseStateButton = $("#uploadBib").attr("class")
                    ,collapseStateForm = $("#addPub").attr("class");
                if (this.checked) {//显示按钮
                    if (collapseStateForm.indexOf("collapse in") == -1){//当前为隐藏
                        $("#uploadBib").attr("class", collapseStateButton.replace('collapse in', "collapse"));
                        $("#addPub").attr("class", collapseStateForm.replace('collapse', "collapse in"));
                    }
                }else{//显示输入表单
                    if (collapseStateButton.indexOf("collapse in") == -1){//当前为隐藏
                        $("#uploadBib").attr("class", collapseStateButton.replace('collapse', "collapse in"));
                        $("#addPub").attr("class", collapseStateForm.replace('collapse in', "collapse"));
                    }
                }
            });
        });
    </script>

    <script>
        //新增文献面板内的操作:1）按钮（提交、重置）；2）
        var formSettings = [{"field":"0", "mandatory":[0,1,2,3,22], "others":[4,5,6,7,8]}
                            ,{"field":"1", "mandatory":[0,1,3,9,10,22], "others":[4,5,7,8,11,12,13]}
                            ,{"field":"2", "mandatory":[1,22], "others":[0,3,7,8,12,14]}
                            ,{"field":"3", "mandatory":[0,1,3,15,22], "others":[4,5,6,7,8,9,10,11,12,16]}
                            ,{"field":"4", "mandatory":[0,1,3,6,9,10,17,22], "others":[4,5,7,8,11,12,13,18]}
                            ,{"field":"5", "mandatory":[0,1,3,10,15,22], "others":[4,5,6,7,8,9,11,12,13,17,18]}
                            ,{"field":"6", "mandatory":[0,1,3,15,22], "others":[4,5,6,7,8,9,10,11,12,16]}
                            ,{"field":"7", "mandatory":[1,22], "others":[0,3,7,8,12,13,16]}
                            ,{"field":"8", "mandatory":[0,1,3,19,22], "others":[7,8,12,18]}
                            ,{"field":"9", "mandatory":[22], "others":[0,1,3,7,8,14]}
                            ,{"field":"10", "mandatory":[0,1,3,19,22], "others":[7,8,12,20]}
                            ,{"field":"11", "mandatory":[1,3,22], "others":[4,5,7,8,9,10,11,12,16]}
                            ,{"field":"12", "mandatory":[0,1,3,21,22], "others":[5,7,8,9,18]}
                            ,{"field":"13", "mandatory":[0,1,8,22], "others":[3,7]}
                            ]; //每种类型文献的字段分组，必填和选填内容（数字表示contentStringName中的下标）
        var contentStringName = ["author","title","journal","year","volume","number",
                                "pages","month","note","editor","publisher","series","address",
                                "edition","how_published","book_title","organization","chapter",
                                "type","school","keywords","institution","indexing"];//文献字段值
        var pubTypes = ["ARTICLE", "BOOK","BOOKLET","CONFERENCE","INBOOK","INCOLLECTION","INPROCEEDINGS",
                         "MANUAL","MASTERSTHESIS","MISC","PHDTHESIS","PROCEEDINGS","TECHREPORT","UNPUBLISHED"];//文献类型
        var currentPubType = 0;//当前选择的文献类型

        var siteUrl = "http://127.0.0.1:8000"
            ,addPubService = "/add-pub/"
            ,addPersonService = "/add-person/"
            ,addVenueService = "/add-venue/"
            ,addRelService = "/add-relation/"
            ,editPubService = "/edit-pub/"
            ,authService = "/verify/"
            ,uploadBib = '/upload-bib/'
            ,revisePubService = '/revise-pub/'
            ,revisePersonService = '/revise-person/'
            ,reviseVenueService = '/revise-venue/'
            ,searchPubService = '/search-pub/'
            ,searchPersonService = '/search-person/'
            ,searchVenueService = '/search-venue/'
            ,splitNameService = '/split-name/';
        //表单的操作:包括文献详情、高级搜索

        layui.use(['element', 'form', 'layedit', 'table', 'code'], function(){//element只用来让选项卡工作
            var form = layui.form
                ,layer = layui.layer
                ,table = layui.table
                ,$ = layui.$;
            //按钮1-1：重置  -- 新增/编辑文献面板
            form.on('submit(resetAddPubPanel)', function(){
                //文献类型自动重置了
                toggleEditPanel(formSettings, contentStringName, 0, 'addPub');
                form.render();
            });
            form.on('submit(resetEditPubPanel)', function(){
                //文献类型自动重置了
                toggleEditPanel(formSettings, contentStringName, 0, 'editPub');
                form.render();
            });
            //按钮1-2：重置  -- 新增/编辑person面板
            form.on('submit(resetAddPersonPanel)', function(){
                form.render();
            });
            form.on('submit(resetEditPersonPanel)', function(){
                form.render();
            });
            //按钮1-3：重置  -- 新增/编辑venue面板
            form.on('submit(resetAddVenuePanel)', function(){
                form.render();
            });
            form.on('submit(resetEditVenuePanel)', function(){
                form.render();
            });
            //按钮2-1：提交文献信息
            form.on('submit(newPubSubmit)', function(data){
                console.log("提交的表单数据：" + JSON.stringify(data.field));
                msg = verifyPubInfo(data.field, contentStringName, currentAuthors);
                if (msg["status"]<1) {
                    layer.msg(msg["msg"]);
                    console.log("结束验证————失败，取消创建新文献");
                }else{
                    console.log("结束验证————正确，写入数据库....");
                    writeToDatabase(siteUrl, addPubService, msg["processedData"], '');
                }
                return false;
            });
            form.on('submit(editPubSubmit)', function(data){
                console.log("提交的表单数据：" + JSON.stringify(data.field));
                msg = verifyPubInfo(data.field, contentStringName, currentAuthors);
                if (msg["status"]<1) {
                    layer.msg(msg["msg"]);
                    console.log("结束验证————失败，取消修改文献");
                }else{
                    console.log("结束验证————正确，写入数据库....");
                    writeToDatabase(siteUrl, revisePubService, msg["processedData"], "editPub");
                }
                return false;
            });
            //按钮2-2：提交人信息
            form.on('submit(newPersonSubmit)', function(data){
                console.log("提交的表单数据：" + JSON.stringify(data.field));
                msg = verifyPersonInfo(data.field);
                if (msg["status"]<1) {
                    layer.msg(msg["msg"]);
                    console.log("结束验证————失败，取消创建人节点");
                }else{
                    console.log("结束验证————正确，写入数据库....");
                    writeToDatabase(siteUrl, addPersonService, msg["processedData"], "");
                }
                return false;
            });
            form.on('submit(editPersonSubmit)', function(data){
                console.log("提交的表单数据：" + JSON.stringify(data.field));
                msg = verifyPersonInfo(data.field);
                if (msg["status"]<1) {
                    layer.msg(msg["msg"]);
                    console.log("结束验证————失败，取消修改人的信息");
                }else{
                    console.log("结束验证————正确，写入数据库....");
                    writeToDatabase(siteUrl, revisePersonService, msg["processedData"], "editPerson");
                }
                return false;
            });
            //按钮2-3：提交venue信息
            form.on('submit(newVenueSubmit)', function(data){
                console.log("提交的表单数据：" + JSON.stringify(data.field));
                msg = verifyVenueInfo(data.field);
                if (msg["status"]<1) {
                    layer.msg(msg["msg"]);
                    console.log("结束验证————失败，取消创建新期刊/会议");
                }else{
                    console.log("结束验证————正确，写入数据库....");
                    writeToDatabase(siteUrl, addVenueService, msg["processedData"], "");
                }
                return false;
            });
            form.on('submit(editVenueSubmit)', function(data){
                console.log("提交的表单数据：" + JSON.stringify(data.field));
                msg = verifyVenueInfo(data.field);
                if (msg["status"]<1) {
                    layer.msg(msg["msg"]);
                    console.log("结束验证————失败，取消修改期刊/会议");
                }else{
                    console.log("结束验证————正确，写入数据库....");
                    writeToDatabase(siteUrl, reviseVenueService, msg["processedData"], "editVenue");
                }
                return false;
            });
            //按钮3：取消编辑文献按钮
            form.on('submit(cancelEditPubPanel)', function(data){
                console.log("取消文献编辑操作");
                $('#editPub').attr('class', 'collapse');
                return false;
            });
            //按钮4-1：高级搜索（文献）
            form.on('submit(searchPub)', function(data){
                console.log("提交的表单数据：" + JSON.stringify(data.field));
                console.log("查找数据库....");
                advanceSearchHandler('queriedPubsDiv', 'editPub', 'pubTableAfterSearch', 'pubSearchTableContent', 'toolbarEditPubGetData', data, table, searchPubService);
                return false;
            });
            //按钮4-2：高级搜索（人）
            form.on('submit(searchPerson)', function(data){
                console.log("提交的表单数据：" + JSON.stringify(data.field));
                console.log("查找数据库....");
                advanceSearchPersonHandler('queriedPersonsDiv', 'editPerson', 'personTableAfterSearch', 'personSearchTableContent', 'toolbarEditPersonGetData', data, table, searchPersonService);
                return false;
            });
            //按钮4-3：高级搜索（venue）
            form.on('submit(searchVenue)', function(data){
                console.log("提交的表单数据：" + JSON.stringify(data.field));
                console.log("查找数据库....");
                advanceSearchVenueHandler('queriedVenueDiv', 'editVenue', 'venueTableAfterSearch', 'venueSearchTableContent', 'toolbarEditVenueGetData', data, table, searchVenueService);
                return false;
            });
            //按钮5：新增关系面板---选择文献按钮
            form.on('submit(searchPubInPopUp)', function(data){
                console.log("提交的表单数据：" + JSON.stringify(data.field));
                console.log("查找数据库....");
                advanceSearchHandler('queriedPubsDivInPopUp', '', 'pubTableAfterSearchInPopUp', 'pubSearchTableContentInPopUpt', 'toolbarPopUpGetData', data, table, searchPubService);
                return false;
            });
            //按钮6：新增关系面板---确认按钮
            form.on('submit(relConfirm)', function(data){
                var sourceInfo = document.getElementById("addRelSourceInfo").innerText;
                var targetInfo = document.getElementById("addRelTargetInfo").innerText;
                if (sourceInfo == ""){
                    layui.layer.msg("未选择起点！", {
                        time: 5000, //5s后自动关闭
                        btn: ['ok'],
                        icon:5
                    });
                    return false;
                }
                if (targetInfo == ""){
                    layui.layer.msg("未选择终点！", {
                        time: 5000, //5s后自动关闭
                        btn: ['ok'],
                        icon:5
                    });
                    return false;
                }
                try{
                    sourceInfo = JSON.parse(sourceInfo);
                    targetInfo = JSON.parse(targetInfo);
                    sourceInfo = sourceInfo["uuid"];
                    targetInfo = targetInfo["uuid"];
                }catch(e){
                    layui.layer.msg("选择的数据不是JSON格式数据！", {
                        time: 5000, //5s后自动关闭
                        btn: ['ok'],
                        icon:5
                    });
                    return false;
                }
                var sourceType = document.getElementById("relSource").innerHTML;
                var targetType = document.getElementById("relTarget").innerHTML;
                var relType = document.getElementById("relation_type_select").value;
                if (relType == "0"){
                    relType = "Publish_In".toUpperCase();
                }else if (relType == "1"){
                    relType = "Write".toUpperCase();
                }else{
                    relType = "Cite".toUpperCase();
                }
                var params = {sourceType: sourceType, targetType:targetType, sourceID:sourceInfo, targetID:targetInfo, relType:relType}; // ------------
                var csrftoken = Cookies.get('csrftoken');
                $.ajax({
                    type: 'POST'
                    ,url: siteUrl + addRelService
                    ,data:  JSON.stringify(params)
                    ,dataType : "json"
                    ,headers: {'Content-Type': 'application/json',"X-CSRFToken":csrftoken}
                    //,contentType: "application/json"
                    ,success: function(result,status,xhr) {  //分配到相应的表单中
                        console.log("数据传输成功");
                        if (result.status < 1) {
                            layui.layer.msg('请求错误，未建立关系<br>' + JSON.stringify(result.msg), {
                                time: 20000, //20s后自动关闭
                                btn: ['ok'],
                                icon:1
                            });
                        }else{
                            //成功，重置面板
                            document.getElementById("addRelSourceInfo").innerText = "";
                            document.getElementById("addRelTargetInfo").innerText = "";
                        }
                        layui.form.render();
                        return false;
                    }
                    ,error: function(xhr,status,error){
                        console.log("数据传输失败后：");
                        //如果请求失败要运行的函数
                        layui.layer.msg("与服务器断开连接，请稍后再试。", {
                            time: 10000, //20s后自动关闭
                            btn: ['ok'],
                            icon:5
                        });
                        console.log(error);
                    }
                    ,complete: function(xhr,status){
                        console.log("数据传输complete");
                        //完成时的操作，success和error之后
                    }
                });
                return false;
            });
            //3）根据选择的文献类型，决定显示的字段都有哪些
            form.on('select(paperTypeAdd)', function(data){
                var value = data.value;
                value = new Number(value);
                if (value.valueOf() != currentPubType.valueOf()) {
                    toggleEditPanel(formSettings, contentStringName, value, 'addPub');
                    form.render();
                }
            });
            form.on('select(paperTypeEdit)', function(data){
                var value = data.value;
                value = new Number(value);
                if (value.valueOf() != currentPubType.valueOf()) {
                    toggleEditPanel(formSettings, contentStringName, value, 'editPub');
                    form.render();
                }
            });

            //(4)监听下拉复选框全选功能:包括高级搜索面板
            form.on('checkbox', function(data){
                var allOptions = data.elem.parentElement
                        .parentElement
                        .parentElement
                        .parentElement
                        .parentElement
                        .children.item("select").children;
                if (data.elem.title=="全选"){
                    if (data.elem.checked) {
                        for (i=0;i<allOptions.length;i++) {
                            allOptions[i].setAttribute("selected",true);
                        }
                    }else {
                        for (i=0;i<allOptions.length;i++) {
                            allOptions[i].removeAttribute("selected");
                        }
                    }
                    form.render('select');
                    form.render('checkbox');
                }
            });
            //(5)新建节点关系时,显示节点搜索框
            var currentSelectedRel;
            function resetNodeInfoDiv(){
                var $ = layui.$;
                var divStatus = $('#addRelInfoDiv').attr('class');
                if (divStatus.indexOf('collapse in') > -1){
                    $('#addRelInfoDiv').attr('class', divStatus.replace('collapse in', 'collapse'));
                }
                document.getElementById("addRelSourceInfo").innerText = "";
                layui.code();
                document.getElementById("addRelTargetInfo").innerText = "";
                layui.code();
            }
            function resetAddRelDivs(){
                var $ = layui.$;
                var divStatus = $('#addRelSourcceTarget').attr('class');
                if (divStatus.indexOf('collapse in') > -1){
                    $('#addRelSourcceTarget').attr('class', divStatus.replace('collapse in', 'collapse'));
                }
                divStatus = $('#addRelConfirm').attr('class');
                if (divStatus.indexOf('collapse in') > -1){
                    $('#addRelConfirm').attr('class', divStatus.replace('collapse in', 'collapse'));
                }
                resetNodeInfoDiv();
            }
            form.on('select(relation_type_select)', function(data){
                var value = data.value;
                if (value == "") {
                    resetAddRelDivs();
                    console.log('未选择关系类型');
                    return;
                }
                value = new Number(value);
                if (value == 0){
                    var addRelSourcceTargetStatus = $('#addRelSourcceTarget').attr('class');
                    if (addRelSourcceTargetStatus.indexOf('collapse in') == -1){
                        $('#addRelSourcceTarget').attr('class', addRelSourcceTargetStatus.replace('collapse', 'collapse in'));
                    }
                    document.getElementById("relSource").innerHTML = 'Publication';
                    document.getElementById("relTarget").innerHTML = 'Venue';
                    form.render();
                }else if (value == 1){
                    var addRelSourcceTargetStatus = $('#addRelSourcceTarget').attr('class');
                    if (addRelSourcceTargetStatus.indexOf('collapse in') == -1){
                        $('#addRelSourcceTarget').attr('class', addRelSourcceTargetStatus.replace('collapse', 'collapse in'));
                    }
                    document.getElementById("relSource").innerHTML = 'Person';
                    document.getElementById("relTarget").innerHTML = 'Publication';
                    form.render();
                }else if (value == 2){
                    var addRelSourcceTargetStatus = $('#addRelSourcceTarget').attr('class');
                    if (addRelSourcceTargetStatus.indexOf('collapse in') == -1){
                        $('#addRelSourcceTarget').attr('class', addRelSourcceTargetStatus.replace('collapse', 'collapse in'));
                    }
                    document.getElementById("relSource").innerHTML = 'Publication';
                    document.getElementById("relTarget").innerHTML = 'Publication';
                    form.render();
                }else{
                    console.log('未定义关系类型');
                    resetAddRelDivs();
                    return;
                }
                addRelSConfirmStatus = $('#addRelConfirm').attr('class');
                if (addRelSConfirmStatus.indexOf('collapse in') == -1){
                    $('#addRelConfirm').attr('class', addRelSConfirmStatus.replace('collapse', 'collapse in'));
                }
                //当不是第一次点击时，隐藏下面节点详细信息的div
                if (currentSelectedRel != undefined & currentSelectedRel != value){
                    resetNodeInfoDiv(); //
                }
                currentSelectedRel = value;
            });
            //(6)新增关系-起讫点
            form.on('submit(relSource)', function(data){
                window.currentClickButton = "relSource";
                processPopupWindow('relSource', "addRelInfoDiv");
                return false;
            });
            form.on('submit(relTarget)', function(data){
                window.currentClickButton = "relTarget";
               processPopupWindow('relTarget', "addRelInfoDiv");
                return false;
            });
        });
    </script>

    <script>
        //关于表格的控件
        layui.config({
            base: '/static/layui2/lay/layui_extend/' //插件路径
        }).extend({
            enhanceform: 'enhanceform'
        });
        //1)"新增"|"修改"文献面板中作者信息表格
        var currentAuthors; // 当前已经填写的作者名单----新增文献面板
        var selectedPubInfo; // 当前选择修改的文献内容

        layui.use(['table', 'form', 'enhanceform'], function(){
            var table = layui.table
                ,$ = layui.$
                ,form = layui.form
                ,enhanceForm = layui.enhanceform;

            //监听作者表格中增加/删除按钮
            table.on('tool(demo)', function(obj){
                addOrDeleteAuthor(currentAuthors, 'authorTable', layui, obj);
            });
            table.on('tool(demoEdit)', function(obj){
                addOrDeleteAuthor(currentAuthors, 'authorTableEdit', layui, obj);
            });

            //监听作者表格中作者信息编辑
            table.on('edit(demo)', function(obj){
                editAuthor(currentAuthors, 'authorTable', layui, obj);
            });
            table.on('edit(demoEdit)', function(obj){
                editAuthor(currentAuthors, 'authorTableEdit', layui, obj);
            });

            //表格1）新增文献表格中作者信息表格作者表格
            table.render({
                elem: '#authorTableAdd'
                ,url: '/demo/table/user/'
                ,cols: [[
                  {field:'firstName', title:'名', width:100, edit: 'text'}
                  ,{field:'middleName', title:'中间名', width:100, edit: 'text'}
                  ,{field:'lastName', title:'姓', width:100, edit: 'text'}
                  ,{field:'ranking', title:'排名', width:100, sort: true, edit: 'text'}
                  ,{width:150, align:'center', toolbar: '#authorBarsAdd'}
                ]]
                ,id: 'authorTable'
                ,page: false
                ,done: function(res, curr, count){
                    currentAuthors = deepClone(res["data"]);
                }
            });
            //表格2）编辑文献表格中作者信息表格
            table.render({
                elem: '#authorTableEdit'
                ,url: '/demo/table/user/'
                ,cols: [[
                  {field:'firstName', title:'名', width:100, edit: 'text'}
                  ,{field:'middleName', title:'中间名', width:100, edit: 'text'}
                  ,{field:'lastName', title:'姓', width:100, edit: 'text'}
                  ,{field:'ranking', title:'排名', width:100, sort: true, edit: 'text'}
                  ,{width:150, align:'center', toolbar: '#authorBarsAdd'}
                ]]
                ,id: 'authorTableEdit'
                ,page: false
                ,done: function(res, curr, count){
                    currentAuthors = deepClone(res["data"]);
                }
            });
            //按钮1：查看详情选项卡-----查询结果表格，文献编辑按钮
            table.on('toolbar(pubTableAfterSearch)', function(obj){
                currentAuthors = setEditNodePanel(obj, "Publication", siteUrl, splitNameService, formSettings, contentStringName, enhanceForm);
            });
            //按钮2：查看详情选项卡-----查询结果表格，人员信息编辑按钮
            table.on('toolbar(personTableAfterSearch)', function(obj){
                currentPersons = setEditNodePanel(obj, "Person", "", "", "", "", enhanceForm);
            });
            //按钮3：查看详情选项卡-----查询结果表格，venue编辑按钮
            table.on('toolbar(venueTableAfterSearch)', function(obj){
                currentPersons = setEditNodePanel(obj, "Venue", "", "", "", "", enhanceForm);
            });
        });
    </script>

    <script>
    //关于时间的控件
    layui.use('laydate', function(){
        var laydate = layui.laydate
            ,myDate = new Date();;

        //(1)新增文献面板:文献时间年
        var ins3 = laydate.render({
            elem: '#pubYearAdd'
            ,type: 'year'
            ,range: false
            ,showBottom: true
            ,isInitValue: false
            ,change:function(value, date, endDate) {
                console.log(value);
            }
        });
        //(2)新增文献面板:文献时间月
        var ins4 = laydate.render({
            elem: '#pubMonthAdd'
            ,type: 'month'
            ,range: false
            ,format: 'MM'
            ,showBottom: true
            ,isInitValue: false
            ,change:function(value, date, endDate) {
                console.log(value);
            }
        });
        //（3）高级搜索:起始年范围, 限定可选时间
        var ins2 = laydate.render({
            elem: '#startTime'
            ,type: 'year'
            ,range: false
            ,max: myDate.toLocaleDateString()     //获取当前日期
            ,min: '1900-01-01'
            ,showBottom: false
            ,change: function(value, date, endDate){
                var $ = jQuery = layui.$;
                var endTime = document.getElementById('endTime').value;
                if (endTime < value){
                    //不能更早
                    ins2.hint('起始时间不可晚于终止时间');
                }else {
                    $("#startTime").val(value);
                    if($(".layui-laydate").length){
                        $(".layui-laydate").remove();
                    }
                }
            }
        });

        //（4）高级搜索:终止年范围, 限定可选时间
        var ins1 = laydate.render({
            elem: '#endTime'
            ,type: 'year'
            ,range: false
            ,max: myDate.toLocaleDateString()     //获取当前日期
            ,min: '1900-01-01'
            ,showBottom: false
            ,isInitValue: true
            ,value: myDate.getFullYear()
            ,change: function(value, date, endDate){
                var $ = jQuery = layui.$;
                var startTime = document.getElementById('startTime').value;
                if (startTime != "" && startTime > value){
                    //不能更早
                    ins1.hint('终止时间不可超过起始时间');
                }else {
                    $("#endTime").val(value);
                    if($(".layui-laydate").length){
                        $(".layui-laydate").remove();
                    }
                }
            }
        });

        //(5)编辑文献面板:文献时间年
        var ins3 = laydate.render({
            elem: '#pubYearEdit'
            ,type: 'year'
            ,range: false
            ,showBottom: true
            ,isInitValue: false
            ,change:function(value, date, endDate) {
                console.log(value);
            }
        });
        //(6)编辑文献面板:文献时间月
        var ins4 = laydate.render({
            elem: '#pubMonthEdit'
            ,type: 'month'
            ,range: false
            ,format: 'MM'
            ,showBottom: true
            ,isInitValue: false
            ,change:function(value, date, endDate) {
                console.log(value);
            }
        });
    });
    </script>

    <script>
        //上传文件的组件
        layui.use('upload', function(){
            var $ = layui.jquery
            ,upload = layui.upload;
            var demoListView = $('#demoList')
                ,uploadListIns = upload.render({
                    elem: '#chooseBibFile'
                    ,url: siteUrl + uploadBib
                    ,accept: 'file'
                    //,exts:"bib|txt"
                    ,multiple: true
                    ,auto: false
                    ,bindAction: '#testListAction'
                    ,choose: function(obj){
                        var files = this.files = obj.pushFile(); //将每次选择的文件追加到文件队列
                        //读取本地文件
                        obj.preview(function(index, file, result){
                            var tr = $(['<tr id="upload-'+ index +'">'
                                ,'<td>'+ file.name +'</td>'
                                ,'<td>'+ (file.size/1014).toFixed(1) +'kb</td>'
                                ,'<td>等待上传</td>'
                                ,'<td>'
                                ,'<button class="layui-btn layui-btn-xs demo-reload layui-hide">重传</button>'
                                ,'<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
                                ,'</td>'
                                ,'</tr>'].join(''));

                        //单个重传
                        tr.find('.demo-reload').on('click', function(){
                            obj.upload(index, file);
                        });

                        //删除
                        tr.find('.demo-delete').on('click', function(){
                            delete files[index]; //删除对应的文件
                            tr.remove();
                            uploadListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
                        });

                        demoListView.append(tr);
                    });
                }
                ,before: function(obj){
                    var files = this.files;
                }
                ,done: function(res, index, upload){
                    if(res.status == 1){ //上传成功
                        var tr = demoListView.find('tr#upload-'+ index)
                            ,tds = tr.children();
                        tds.eq(2).html('<span style="color: #5FB878;">上传成功</span>');
                        tds.eq(3).html(''); //清空操作
                        console.log(res.msg);
                        return delete this.files[index]; //删除文件队列已经上传成功的文件
                    }
                    this.error(index, upload);
                }
                ,allDone: function(obj){ //当文件全部被提交后，才触发
                    console.log(obj.total); //得到总文件数
                    console.log(obj.successful); //请求成功的文件数
                    console.log(obj.aborted); //请求失败的文件数
                }
                ,error: function(index, upload){
                    var tr = demoListView.find('tr#upload-'+ index)
                        ,tds = tr.children();
                        tds.eq(2).html('<span style="color: #FF5722;">上传失败</span>');
                        tds.eq(3).find('.demo-reload').removeClass('layui-hide'); //显示重传
                    }
                });
        });
    </script>

    <script>
        //监听input输入、select选择
        //(1)中文名分拆
        layui.use(['layer','form'], function(){
            var $ = layui.$
                ,form = layui.form
                .layer = layui.layer;
            $(document).ready(function(){ 
                //1）新增面板：英文名 
                $("#full_name_en").keydown(function(event){  
                    if (event.keyCode == 13){  
                        analyzeNameEN('full_name_en', ['first_en', 'mid_en', 'last_en'], siteUrl, splitNameService);
                        return false;
                    }  
                }); 
                //2）新增面板：中文名
                $("#full_name_ch").keydown(function(event){  
                    if (event.keyCode == 13) {  
                    analyzeNameCH('full_name_ch', ['first_ch', 'last_ch'], siteUrl, splitNameService);
                        return false;
                    }
                }); 
                //3）新增面板：英文名 
                $("#full_name_edit").keydown(function(event){  
                    if (event.keyCode == 13){  
                        analyzeNameEN('full_name_edit', ['first_name_edit', 'mid_name_edit', 'last_name_edit'], siteUrl, splitNameService);
                        return false;
                    }  
                }); 
                //4）新增面板：中文名
                $("#name_ch_edit").keydown(function(event){  
                    if (event.keyCode == 13) {  
                    analyzeNameCH('name_ch_edit', ['first_name_ch_edit', 'last_name_ch_edit'], siteUrl, splitNameService);
                        return false;
                    }
                });  
                //其他input回车不提交 
                $(".layui-input").keydown(function(event){  
                    if (event.keyCode == 13){  
                        return false;
                    }  
                }); 
            });
        });
    </script>
</body>
</html>