<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    {% load static %}
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="{% static 'images/favicon.ico'%} ">

    <title>Continuous Piecewise Linear Analysis</title>

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <!--自定义函数-->
    <script src="{% static 'js/action_new.js'%}"></script>


    <!-- Custom styles for 轮屏 -->
    <link href="{% static 'bootstrap-4.1.1-dist/css/carousel.css'%}" rel="stylesheet">
    <!--控制台样式-->
    <link href="{% static 'bootstrap-4.1.1-dist/css/dashboard.css'%}" rel="stylesheet">

    <style type="text/css">
        .small-font { font-size: 1.5vw;}
        .collapse-disable {transition: none !important;}
    </style>
    <!--layui-->
    <link rel="stylesheet" href="{% static 'layui2/css/layui.css'%}"  media="all">
    <script src="{% static 'layui2/layui.js'%}" charset="utf-8"></script>
    <script src="{% static 'js/js.cookies.js'%}" charset="utf-8"></script>
    <style>
        .layui-table-cell {
            white-space:normal;
            height:inherit;
        }
    </style>
    <!--vis-->
    <style type="text/css">
        #mynetwork {
            width: 800px;
            height: 600px;
            border: 1px solid lightgray;
        }

        #mynetwork2 {
            width: 800px;
            height: 600px;
            border: 1px solid lightgray;
        }

        p {
            max-width:600px;
        }

        h4 {
            margin-bottom:3px;
        }
    </style>
    <script type="text/javascript" src="{% static 'vis/vis.min.js'%}"></script>
    <script type="text/javascript" src="{% static 'vis/vis.js'%}"></script>
    <link href="{% static 'vis/vis-network.min.css'%}" rel="stylesheet" type="text/css">
    <!--导入latex-->
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
</head>
<body>
    <!--顶部导航栏-->

    <div class="container-fluid row">
        <div class="col-sm-12 col-md-12">
            <nav class="navbar navbar-inverse navbar-fixed-top">
              <div class="container-fluid">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                  </button>
                  <a class="navbar-brand" href="#">CPWL</a>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                  <ul class="nav navbar-nav navbar-right">
                    <li><a href="/">首页</a></li>
                    <li id="collapse1-1-title" class="active"><a  onclick="clickSideBar('collapse1-1');collapseSideBar('#collapse1')">关于项目</a></li>
                    <li id="collapse2-1-title"><a onclick="clickSideBar('collapse2-1');collapseSideBar('#collapse2')">成员</a></li>
                    <li id="collapse3-1-title"><a onclick="clickSideBar('collapse3-1');collapseSideBar('#collapse3')">科研成果</a></li>
                    <li id="collapse4-1-title"><a onclick="clickSideBar('collapse4-1');collapseSideBar('#collapse4')">代码</a></li>
                    <li><a href="#">联系我们</a></li>
                  </ul>
                  <form class="navbar-form navbar-right">
                    <input type="text" class="form-control" placeholder="Search...">
                  </form>
                </div>
              </div>
            </nav>
        </div>
        <!--左侧导航栏-->
        <div class="col-sm-3 col-md-2 sidebar">
            <div class="panel-collapse ">
                <ul class="nav nav-sidebar">
                    <li>
                        <a class="panel-title collapse-disable" data-toggle="collapse" data-parent="#accordion" href="#collapse1"> 关于项目</a>
                        <ul class=" nav nav-sidebar panel-body collapse in" id="collapse1">
                            <li class="active " id="collapse1-1"> <a href="#collapse1-1-content"> &nbsp;&nbsp;&nbsp; 项目背景</a></li>
                            <li id="collapse1-2"> <a href="#collapse1-2-content"> &nbsp;&nbsp;&nbsp; 参与团体</a></li>
                        </ul>
                    </li>
                    <li>
                        <a class="panel-title" data-toggle="collapse" data-parent="#accordion" href="#collapse2"> 成员</a>
                        <ul class="nav nav-sidebar  panel-body collapse" id="collapse2">
                            <li id="collapse2-1"> <a href="#collapse2-1-content"> &nbsp;&nbsp;&nbsp; 成员简介</a></li>
                            <li id="collapse2-2"> <a href="#collapse2-2-content"> &nbsp;&nbsp;&nbsp; 关系网络</a></li>
                        </ul>
                    </li>
                    <li>
                        <a class="panel-title" data-toggle="collapse" data-parent="#accordion" href="#collapse3"> 科研成果</a>
                        <ul class="nav nav-sidebar panel-body collapse" id="collapse3">
                            <li id="collapse3-1"> <a href="#collapse3-1-content"> &nbsp;&nbsp;&nbsp; 成果列表</a></li>
                            <li id="collapse3-2"> <a href="#collapse3-2-content"> &nbsp;&nbsp;&nbsp; 网络</a></li>
                        </ul>
                    </li>
                    <li>
                        <a class="panel-title" data-toggle="collapse" data-parent="#accordion" href="#collapse4"> 代码</a>
                        <ul class="nav nav-sidebar panel-body collapse" id="collapse4">
                            <li id="collapse4-1"> <a href="javascript:void(0);"> &nbsp;&nbsp;&nbsp; 代码总览</a></li>
                            <li id="collapse4-2"> <a href="javascript:void(0);"> &nbsp;&nbsp;&nbsp; 网络</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <!--右侧内容栏-->
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <div style="height:auto;">
                        <br><br>
                    </div>
                <!--右侧1.1项目背景-->
                <div id="collapse1-1-content" style="display:auto">
                    <h1 class="page-header">Continuous Piecewise Linear Theory and Technology</h1>

                    <!--手风琴折叠-->
                    <div class="layui-collapse" lay-accordion="">
                        <!--第零个折叠辩题&内容-->
                        <div class="layui-colla-item">
                            <h2 class="layui-colla-title  layui-bg-green" >What are included in the project？</h2>
                            <div class="layui-colla-content  layui-show">
                                本项目旨在介绍连续分片线性函数及相应的理论，以及相应的应用，包括：
                                <div class="table-bordered">
                                    <ul>
                                        <li style="list-style-type:disc;margin-left:20px">
                                            连续分片线性函数的表示模型；
                                        </li>
                                        <li style="list-style-type:disc;margin-left:20px">
                                            基于连续分片线性表示模型的辨识
                                        </li>
                                        <li style="list-style-type:disc;margin-left:20px">
                                            连续分片线性优化问题
                                        </li>
                                        <li style="list-style-type:disc;margin-left:20px">
                                            连续分片线性优化算法
                                        </li>
                                        <li style="list-style-type:disc;margin-left:20px">
                                            连续分片线性技术的应用
                                        </li>
                                    </ul>

                                </div>

                            </div>
                        </div>
                        <!--第一个折叠辩题&内容-->
                        <div class="layui-colla-item">
                            <h2 class="layui-colla-title  layui-bg-green" >What is Continuous Piecewise Linear Function？</h2>
                            <div class="layui-colla-content">
                                <!--分片线性函数-->
                                <fieldset class="layui-elem-field layui-field-title" style="margin-bottom:-10px">
                                    <legend><font size="3">定义1: 分片线性函数</font></legend>
                                </fieldset>
                                称函数\(f : D \in \mathbb{R}^n \to \mathbb{R}\)为分片线性函数，若其满足
                                <div class="table-bordered">
                                    <ul>
                                        <li style="list-style-type:disc;margin-left:20px">
                                            \(\exists D_i \subset D\)，\(\forall i\)，其中\(\bigcup_{i } D_i= D\)，\(\mathring{D}_i \bigcap \mathring{D}_j = \emptyset\)，\(\forall i \neq j\)，\(\mathring{D}_i\)为\(D_i\)的内部；
                                        </li>
                                        <li style="list-style-type:disc;margin-left:20px">
                                            在任一子区域\(D_i\)中，\(f(x) = p_i(x)\)，其中\(p_i(x)\)为仿射函数，
                                        </li>
                                    </ul>
                                </div>
                                其中称\(D_i\)为其线性子区域
                                <!--连续分片线性函数-->
                                <fieldset class="layui-elem-field layui-field-title" style="margin-bottom:-10px">
                                    <legend><font size="3">定义1: 连续分片线性函数</font></legend>
                                </fieldset>
                                称分片线性函数\(f : D \in \mathbb{R}^n \to \mathbb{R}\)为连续分片线性函数，若其满足
                                <div class="table-bordered">
                                    <ul>
                                        <li style="list-style-type:disc;margin-left:20px">
                                            \(f(x) \in \mathbb{C}\)，其中\(\mathbb{C}\)为连续函数空间
                                        </li>
                                    </ul>
                                </div>
                                <!--示例图片-->
                                <img src="{% static 'images/cpwl_1D.png'%}" width="200" height="200" class="img-responsive center-block" alt="Generic placeholder thumbnail">
                            </div>
                        </div>
                        <!--第二个折叠辩题&内容-->
                        <div class="layui-colla-item">
                            <h2 class="layui-colla-title  layui-bg-green">How to represent a CPWL function？</h2>
                            <div class="layui-colla-content">
                                <!--定义式-->
                                <fieldset class="layui-elem-field layui-field-title" style="margin-bottom:-10px">
                                    <legend><font size="3">方式1: 定义式</font></legend>
                                </fieldset>
                                <div class="table-bordered">
                                    \[
                                        f(x) \in \{ p_i(x)\mid  x \in D_i, \forall i\}.
                                    \]
                                </div>
                                <!--典范表示-->
                                <fieldset class="layui-elem-field layui-field-title" style="margin-bottom:-10px">
                                    <legend><font size="3">方式2: 典范表示模型（Canonical Piecewise Linear Model）</font></legend>
                                </fieldset>
                                <div class="table-bordered">
                                    \[
                                        f(x) = b_0 + a_0^T x + \sum_{i = 1}^M  \delta_i |a_i^T x -  b_i|
                                    \]
                                </div>
                                其中\(a_0, a_i \in \mathbb{R}^n ~b_0, b_i \in \mathbb{R}, ~\delta_i = \pm 1\)。
                                <!--格分片-->
                                <fieldset class="layui-elem-field layui-field-title" style="margin-bottom:-10px">
                                    <legend><font size="3">方式3: 格分片线性表示模型（Lattice Piecewise Linear Model）</font></legend>
                                </fieldset>
                                <div class="table-bordered">
                                    \[
                                        f(x ) = \underset{1 \leqslant i \leqslant M}{\min} \underset{j \in s_i}{\max} \{a_j^T x + b_j\}
                                    \]
                                </div>
                                其中\(A = \left( a_1, \cdots, a_m \right) \in \mathbb{R}^{n \times m}\), \(b = \left( b_1, \cdots, b_m \right)^T \in \mathbb{R}^{m}\),
                                \(s_i \subset \{ 1, \cdots, m\}\)。
                                <!--链接超平面（HH：Hinging Hyperplane）模型-->
                                <fieldset class="layui-elem-field layui-field-title" style="margin-bottom:-10px">
                                    <legend><font size="3">方式4: 链接超平面模型（Hinging Hyperplane Model）</font></legend>
                                </fieldset>
                                <div class="table-bordered">
                                    \[
                                        f(x ) = \sum_{i = 1}^M \delta_i B_{\rm HH}^i (x)
                                    \]
                                </div>
                                其中\(B_{\rm HH}^i (x) = \max\{ a_{i1}^T x + b_{i1}, a_{i2}^T x + b_{i2}  \}，\delta_i = \pm 1，\forall i\)。
                                <!--广义链接超平面（GHH：Generalization of Hinging Hyperplane）模型-->
                                <fieldset class="layui-elem-field layui-field-title" style="margin-bottom:-10px">
                                    <legend><font size="3">方式4: 广义链接超平面模型（Generalization of Hinging Hyperplane Model）</font></legend>
                                </fieldset>
                                <div class="table-bordered">
                                    \[
                                        f(x ) = \sum_{i = 1}^M \delta_i B_{\rm GHH}^i (x)
                                    \]
                                </div>
                                其中\(B_{\rm GHH} ^i(x) = \max\{ a_{i1}^T x + b_{i1}, \cdots, a_{iK_i}^T x + b_{iK_i}   \}，\delta_i = \pm 1，\forall i\)。
                                <!--自适应链接超平面（AHH：Adaptive Hinging Hyperplane）模型-->
                                <fieldset class="layui-elem-field layui-field-title" style="margin-bottom:-10px">
                                    <legend><font size="3">方式4: 自适应链接超平面模型（Adaptive Hinging Hyperplane Model）</font></legend>
                                </fieldset>
                                <div class="table-bordered">
                                    \[
                                        f(x ) = a_0 + \sum_{i = 1}^{M} a_i B_{\rm AHH} ^i(x)
                                    \]
                                </div>
                                其中\(B_{\rm AHH}^i (x) = \underset{1 \leqslant k \leqslant K_i}{\max} \{ \min \{ 0, s_{k,i} (x_{v_{k,i}} - \beta_{k,i}) \}\}，\delta_i = \pm 1，\forall i\)。
                            </div>
                        </div>
                        <!--第三个折叠辩题&内容-->
                        <div class="layui-colla-item">
                            <h2 class="layui-colla-title layui-bg-green">What can the CPWL identification do？</h2>
                            <div class="layui-colla-content">
                                在实际应用中，常常难以直接对一般非线性函数进行如积分、微分、求极值等操作。分片线性函数作为一种非线性函数，
                                却具备某些线性函数的特性。同时，由于在任意维实数空间，连续分片线性函数能够以任意精度对任意非线性函数进行
                                逼近，而且GHH等模型具备完全表示能力，可以通过~~~
                            </div>
                        </div>
                        <!--第四个折叠辩题&内容-->
                        <div class="layui-colla-item">
                            <h2 class="layui-colla-title layui-bg-green">What is Continuous Piecewise Linear Optimization？</h2>
                            <div class="layui-colla-content">
                                考虑非线性优化问题
                                \[
                                \begin{array}{rl}
                                \underset{x}{\min} & f_0(x)\\
                                \mbox{s.t.} & f_i(x) \leqslant 0, i = 1, \cdots, m,
                                \end{array}
                                \]
                                若其中\(f_i(x), \forall i\)为分片线性函数，则称上述问题为分片线性优化问题。
                            </div>
                        </div>
                        <!--第五个折叠辩题&内容-->
                        <div class="layui-colla-item">
                            <h2 class="layui-colla-title layui-bg-green">What are CPWL algorithms？</h2>
                            <div class="layui-colla-content">
                                本项目中涉及到如下辨识算法：
                                <div class="layui-collapse" lay-accordion="">
                                    <div class="layui-colla-item">
                                        <h3 class="layui-colla-title layui-bg-cyan">Hinging Hyperplane Identification Algorithm</h3>
                                        <div class="layui-colla-content">
                                            <p>HH辨识算法</p>
                                        </div>
                                    </div>
                                    <div class="layui-colla-item">
                                        <h3 class="layui-colla-title layui-bg-cyan">Adaptive Hinging Hyperplane Identification Algorithm</h3>
                                        <div class="layui-colla-content">
                                            <p>AHH辨识算法</p>
                                        </div>
                                    </div>
                                </div>
                                本项目中涉及到如下优化算法，
                                <!--第二级折叠-->
                                <div class="layui-collapse" lay-accordion="">
                                    <div class="layui-colla-item">
                                        <h3 class="layui-colla-title layui-bg-cyan">Modified Coordinate Descent Algorithm</h3>
                                        <div class="layui-colla-content">
                                            <p>坐标轮换法</p>
                                        </div>
                                    </div>
                                    <div class="layui-colla-item">
                                        <h3 class="layui-colla-title layui-bg-cyan">CPWL Genetic Algorithm</h3>
                                        <div class="layui-colla-content">
                                            <p>遗传算法</p>
                                        </div>
                                    </div>
                                    <div class="layui-colla-item">
                                        <h3 class="layui-colla-title layui-bg-cyan">Hill-contouring Algorithm</h3>
                                        <div class="layui-colla-content">
                                            <p>绕山法</p>
                                        </div>
                                    </div>
                                    <div class="layui-colla-item">
                                        <h3 class="layui-colla-title layui-bg-cyan">Hill-tunneling Algorithm</h3>
                                        <div class="layui-colla-content">
                                            <p>穿山法</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--第六个折叠辩题&内容-->
                        <div class="layui-colla-item">
                            <h2 class="layui-colla-title layui-bg-green">What can CPWL be applied on？</h2>
                            <div class="layui-colla-content">
                                本项目中涉及到CPWL在以下领域的应用研究：
                                <div class="layui-collapse" lay-accordion="">
                                    <div class="layui-colla-item">
                                        <h3 class="layui-colla-title layui-bg-cyan">Support Vector Machines</h3>
                                        <div class="layui-colla-content">
                                            <p>rampl loss with L1 regularization</p>
                                        </div>
                                    </div>
                                    <div class="layui-colla-item">
                                        <h3 class="layui-colla-title layui-bg-cyan">Prospect Theory</h3>
                                        <div class="layui-colla-content">
                                            <p>展望理论</p>
                                        </div>
                                    </div>
                                    <div class="layui-colla-item">
                                        <h3 class="layui-colla-title layui-bg-cyan">Compressed sensing</h3>
                                        <div class="layui-colla-content">
                                            <p>压缩感知</p>
                                        </div>
                                    </div>
                                    <div class="layui-colla-item">
                                        <h3 class="layui-colla-title layui-bg-cyan">Memristor</h3>
                                        <div class="layui-colla-content">
                                            <p>忆阻</p>
                                        </div>
                                    </div>
                                    <div class="layui-colla-item">
                                        <h3 class="layui-colla-title layui-bg-cyan">Others</h3>
                                        <div class="layui-colla-content">
                                            <p>其他</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--end of 手风琴折叠-->
                </div>
                <!--右侧1.2参与团体-->
                <div id="collapse1-2-content" style="display:none">
                    <h1 class="page-header">参与团体</h1>

                    <div class="row placeholders">
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/logo_thu2.png'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>清华大学自动化系</h4>
                            <!--<span class="text-muted">-->
                                <!--早在20世纪50年代，清华大学就设置了与自动化学科有关的一批专业。1970年5月，学校将有关的专业联合归并，-->
                                <!--组建了国内第一个自动化系。-->
                            <!--</span>-->
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/logo_hitsz_Auto.png'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>哈尔滨工业大学（深圳）机电工程与自动化学院</h4>
                            <!--<span class="text-muted">-->
                                <!--控制科学与工程一级学科-->
                            <!--</span>-->
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/logo_shanghaijiaotong_auto.jpg'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>上海交通大学自动化系</h4>
                            <!--<span class="text-muted">-->
                                <!--上海交通大学自动化系隶属于上海交通大学电子信息与电气工程学院，-->
                                <!--是控制科学与工程国家一级重点学科依托的实体单位，也是“系统控制与信息处理教育部重点实验室”的依托单位。-->
                            <!--</span>-->
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/logo_norincogroup.jpg'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>中国兵器工业集团有限公司</h4>
                            <!--<span class="text-muted">-->
                                <!--中国兵器工业集团有限公司是国家安全和三军装备发展的基础，是陆军装备研制生产的主体，是三军毁伤打击和信息化-->
                                <!--装备发展的骨干，是国家实施“走出去”和“一带一路”战略的支撑，是国家推进军民融合深度发展的主力。-->
                            <!--</span>-->
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/logo_sst_trimmed.jpg'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>上海交通大学管理学院</h4>
                            <!--<span class="text-muted">-->
                                <!--管理学院前身为我国最早成立的系统工程系和系统工程研究所（1979年），1992年5月系所合并成立系统科学与系统工程学院，-->
                                <!--1999年5月更名为管理学院，2004年原上海医疗专科学校管理系划归管理学院，2006年1月与商学院合并重组成立新的管理学院（Business School）。-->
                                <!--2009年我校城建学院交通工程研究所并入我院。汪应洛院士任名誉院长、院务委员会主任。-->
                            <!--</span>-->
                        </div>
                    </div>
                </div>
                <!--右侧2.1成员简介-->
                <div id="collapse2-1-content" style="display:none">
                    <h1 class="page-header">成员</h1>
                    <!--成员row1-->
                    <div class="row placeholders">
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/wangshuning.jpg'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>王书宁</h4>
                            <h5>博士 教授 博士生导师</h5>
                            <h5>清华大学</h5>
                            <span class="text-muted"> His current research interests are mainly in developing practical methods for nonlinear system identification, control and optimization via piecewise-linear approximation.</span>
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/xujun.jpg'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>许鋆</h4>
                            <h5>博士 副教授 硕士生导师</h5>
                            <h5>哈尔滨工业大学（深圳）</h5>
                          <span class="text-muted">研究方向：分片线性函数、基于数据的非线性系统建模，优化及控制</span>
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/huangxiaolin.jpg'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>黄晓霖</h4>
                            <h5>博士 副教授 硕士生导师</h5>
                            <h5>哈尔滨工业大学（深圳）</h5>
                          <span class="text-muted">研究方向：机器学习算法，优化算法，及其工业应用</span>
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/wangjing.JPG'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>王晶</h4>
                            <h5>博士 工程师</h5>
                            <h5>中国兵器工业集团</h5>
                          <span class="text-muted">研究方向：机器人运动控制系统设计</span>
                        </div>
                    </div>
                    <!--成员row2-->
                    <div class="row placeholders">
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/somebody.png'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>牟晓牧</h4>
                            <h5>博士 工程师</h5>
                            <h5>360</h5>
                          <span class="text-muted">研究方向：软件算法</span>
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/xixiangming.jpg'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>袭向明</h4>
                            <h5>博士 工程师</h5>
                            <h5>华为技术有限公司</h5>
                          <span class="text-muted">研究方向：知识图谱构建及推理，分片线性网络及优化算法等</span>
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/wangyongli.jpeg'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>王勇莉</h4>
                            <h5>博士</h5>
                            <h5>高等教育出版社</h5>
                          <span class="text-muted">研究方向：</span>
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/somebody.png'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>李星野</h4>
                            <h5>博士 教授 </h5>
                            <h5>上海理工大学管理学院</h5>
                          <span class="text-muted">研究方向：时间序列分析、数字图像处理、控制系统分析、数字信号处理</span>
                        </div>
                    </div>
                    <!--成员row3-->
                    <div class="row placeholders">
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/somebody.png'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>白宇</h4>
                            <h5>博士生</h5>
                            <h5>清华大学</h5>
                          <span class="text-muted">研究方向：最小费用流，分片线性优化</span>
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/somebody.png'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>陶清华</h4>
                            <h5>博士生</h5>
                            <h5>清华大学</h5>
                          <span class="text-muted">研究方向：智能优化算法</span>
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/somebody.png'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>聂志斌</h4>
                            <h5>博士生</h5>
                            <h5>清华大学</h5>
                          <span class="text-muted">研究方向：</span>
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/somebody.png'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>续志明</h4>
                            <h5>博士生</h5>
                            <h5>清华大学</h5>
                          <span class="text-muted">研究方向：</span>
                        </div>
                    </div>
                    <!--成员row4-->
                    <div class="row placeholders">
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/somebody.png'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>辜磊</h4>
                            <h5>博士生</h5>
                            <h5>清华大学</h5>
                          <span class="text-muted">研究方向：最</span>
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/somebody.png'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>刘匡宇</h4>
                            <h5>博士 工程师</h5>
                            <h5>华为技术有限公司</h5>
                          <span class="text-muted">研究方向：</span>
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/somebody.png'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>石继庆</h4>
                            <h5>博士 大将</h5>
                            <h5>xx</h5>
                          <span class="text-muted">研究方向：</span>
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/somebody.png'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>宋天莉</h4>
                            <h5>博士</h5>
                            <h5>xx</h5>
                          <span class="text-muted">研究方向：</span>
                        </div>
                    </div>
                    <!--成员row5-->
                    <div class="row placeholders">
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/somebody.png'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>于俊堂</h4>
                            <h5>博士</h5>
                            <h5>清华大学</h5>
                          <span class="text-muted">研究方向：</span>
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/somebody.png'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>赵峰</h4>
                            <h5>博士</h5>
                            <h5>xx</h5>
                          <span class="text-muted">研究方向：</span>
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/somebody.png'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>章浩</h4>
                            <h5>博士</h5>
                            <h5>xx</h5>
                          <span class="text-muted">研究方向：</span>
                        </div>
                        <div class="col-xs-6 col-sm-3 placeholder">
                            <img src="{% static 'images/somebody.png'%}" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                            <h4>宋天莉</h4>
                            <h5>博士</h5>
                            <h5>xx</h5>
                          <span class="text-muted">研究方向：</span>
                        </div>
                    </div>
                </div>
                <!--右侧2.2关系网络-->
                <div id="collapse2-2-content" style="display:none">
                    <h1 class="page-header">网络</h1>

                    <div id="mynetwork">
                        <div class="vis-network" tabindex="900" style="position: relative; overflow: hidden; touch-action: pan-y; user-select: none; -webkit-user-drag: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); width: 100%; height: 100%;">
                            <canvas width="1200" height="800" style="position: relative; touch-action: none; user-select: none; -webkit-user-drag: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); width: 100%; height: 100%;">
                            </canvas>
                        </div>
                    </div>
                </div>

                <!--右侧3.1成果列表-->
                <div id="collapse3-1-content" style="display:none">
                <!--高级搜索-->
                    <div>
                        <button style="width:100px" class="layui-btn layui-btn-radius" data-toggle="collapse" data-target="#advanceSearch" onclick="toggleAdvanceSearch()">
                            <p id="advanceSearchButton">高级搜索</p>
                        </button>
                        <button style="width:100px" class="layui-btn layui-btn-radius" data-toggle="collapse" data-target="#operatePubs" onclick="togglePubOperation();">
                            <p id="addPublicationButton">操作文献</p>
                        </button>
                        <div id="operatePubs" class="collapse">
                            <fieldset class="layui-elem-field site-demo-button">
                                <!--操作按钮-->
                                <div class="layui-btn-group">
                                    <!--增加-->
                                    <button class="layui-btn layui-btn-sm" data-toggle="collapse" data-target="#addOrEditPub" id="addPub"><i class="layui-icon">&#xe654;</i></button>
                                    <!--编辑-->
                                    <button class="layui-btn layui-btn-sm" data-toggle="collapse" data-method="editPub" id="editPub"><i class="layui-icon">&#xe642;</i></button>
                                    <!--删除-->
                                    <button class="layui-btn layui-btn-sm"><i class="layui-icon">&#xe640;</i></button>
                                    <!--分享-->
                                    <button class="layui-btn layui-btn-sm"><i class="layui-icon">&#xe641;</i></button>
                                    <!--由文件导入-->
                                    <button class="layui-btn layui-btn-sm" data-toggle="collapse" data-target="#uploadPubFile"><i class="layui-icon">&#xe62f;</i></button>
                                </div>
                                <!--新增/编辑面板-->
                                <div id="addOrEditPub" class="collapse">
                                    <form class="layui-form" action="" lay-filter="addOrEditPubPanel">
                                        <!--文献类型-->
                                        <div class="layui-form-item" id="addOrEditPub-pubType">
                                            <label class="layui-form-label" style="width:100px">文献类型</label>
                                            <div class="layui-input-block">
                                                <select name="paperTypeEdit" lay-filter="paperTypeEdit" lay-verify="required">
                                                    <option value="0" selected>Article</option>
                                                    <option value="1">Book</option>
                                                    <option value="2">Booklet</option>
                                                    <option value="3">Conference</option>
                                                    <option value="4">InBook</option>
                                                    <option value="5">InCollection</option>
                                                    <option value="6">InProceedings</option>
                                                    <option value="7">Manual</option>
                                                    <option value="8">MastersThesis</option>
                                                    <option value="9">Misc</option>
                                                    <option value="10">PhDThesis</option>
                                                    <option value="11">Proceedings</option>
                                                    <option value="12">TechReport</option>
                                                    <option value="13">Unpublished</option>
                                                </select>
                                            </div>
                                        </div>
                                        <!--标题-->
                                        <div class="layui-form-item" id="addOrEditPub-title" style="display:auto">
                                            <label class="layui-form-label" style="width:100px">Title</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="title" placeholder="Title" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--book标题-->
                                        <div class="layui-form-item" id="addOrEditPub-booktitle" style="display:none">
                                            <label class="layui-form-label" style="width:100px">Book Title</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="booktitle" placeholder="Book Title" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--editor-->
                                        <div class="layui-form-item" id="addOrEditPub-editor" style="display:none">
                                            <label class="layui-form-label" style="width:100px">Editor</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="editor" placeholder="Editor" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--keywords-->
                                        <div class="layui-form-item" id="addOrEditPub-keywords" style="display:none">
                                            <label class="layui-form-label" style="width:100px">Keywords</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="keywords" placeholder="Keywords" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--edition-->
                                        <div class="layui-form-item" id="addOrEditPub-edition" style="display:none">
                                            <label class="layui-form-label" style="width:100px">Edition</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="edition" placeholder="Edition" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--作者(表格)-->
                                        <div class="layui-form-item" id="addOrEditPub-author" style="display:auto">
                                            <label class="layui-form-label" style="width:100px;margin-right:10px" >Authors</label>
                                            <div class="layui-input-block ">
                                                <script type="text/html" id="barDemo">
                                                    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="addAuthor" data-type="reload">新增</a>
                                                    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delAuthor">删除</a>
                                                </script>

                                                <table class="layui-hide" id="idTest" lay-filter="demo" name="author"></table>
                                            </div>
                                        </div>
                                        <!--year-->
                                        <div class="layui-form-item" id="addOrEditPub-year" style="display:auto">
                                            <label class="layui-form-label" style="width:100px">Year</label>
                                            <div class="layui-input-inline" style="margin-left:10px">
                                                <input id="pubYear" type="text" name="year" lay-veryfy="date"  placeholder="Year" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--month-->
                                        <div class="layui-form-item" id="addOrEditPub-month" style="display:auto">
                                            <label class="layui-form-label" style="width:100px">Month</label>
                                            <div class="layui-input-inline" style="margin-left:10px">
                                                <input id="pubMonth" type="text" name="month" lay-veryfy="date"  placeholder="Month" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--venue title-->
                                        <div class="layui-form-item" id="addOrEditPub-journal" style="display:auto">
                                            <label class="layui-form-label" style="width:100px">Journal</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="journal" placeholder="Journal" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--volume-->
                                        <div class="layui-form-item" id="addOrEditPub-volume" style="display:auto">
                                            <label class="layui-form-label" style="width:100px">Volume</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="volume" placeholder="Volume" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--type-->
                                        <div class="layui-form-item" id="addOrEditPub-type" style="display:none">
                                            <label class="layui-form-label" style="width:100px">Type</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="type" placeholder="Type" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--chapter-->
                                        <div class="layui-form-item" id="addOrEditPub-chapter" style="display:none">
                                            <label class="layui-form-label" style="width:100px">Chapter</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="chapter" placeholder="Chapter" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--number-->
                                        <div class="layui-form-item" id="addOrEditPub-number" style="display:auto">
                                            <label class="layui-form-label" style="width:100px">Number</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="number" placeholder="Number" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--pages-->
                                        <div class="layui-form-item" id="addOrEditPub-pages" style="display:auto">
                                            <label class="layui-form-label" style="width:100px">Pages</label>
                                            <div class="layui-input-inline" style="margin-left:10px">
                                                <input type="text" name="pages1" placeholder="From" autocomplete="off" class="layui-input">
                                            </div>
                                            <div class="layui-form-mid">
                                                -
                                            </div>
                                            <div class="layui-input-inline">
                                                <input type="text" name="pages2" placeholder="To" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--publisher-->
                                        <div class="layui-form-item" id="addOrEditPub-publisher" style="display:none">
                                            <label class="layui-form-label" style="width:100px">Publisher</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="publisher" placeholder="Publisher" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--organization-->
                                        <div class="layui-form-item" id="addOrEditPub-organization" style="display:none">
                                            <label class="layui-form-label" style="width:100px">Organization</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="organization" placeholder="Organization" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--institution-->
                                        <div class="layui-form-item" id="addOrEditPub-institution" style="display:none">
                                            <label class="layui-form-label" style="width:100px">Institution</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="institution" placeholder="Institution" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--school-->
                                        <div class="layui-form-item" id="addOrEditPub-school" style="display:none">
                                            <label class="layui-form-label" style="width:100px">School</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="school" placeholder="School" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--publisher addr-->
                                        <div class="layui-form-item" id="addOrEditPub-address" style="display:none">
                                            <label class="layui-form-label" style="width:100px">Publisher's Address</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="address" placeholder="Address" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--series-->
                                        <div class="layui-form-item" id="addOrEditPub-series" style="display:none">
                                            <label class="layui-form-label" style="width:100px">Series</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="series" placeholder="Series" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--howpublished-->
                                        <div class="layui-form-item" id="addOrEditPub-howpublished" style="display:none">
                                            <label class="layui-form-label" style="width:100px">How Published</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="howpublished" placeholder="How Published" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--文章索引-->
                                        <div class="layui-form-item" id="addOrEditPub-indexed" style="display:auto">
                                            <label class="layui-form-label" style="width:100px">Indexing</label>
                                            <div class="layui-input-block">
                                                <select name="indexing" >
                                                    <option value="">必填</option>
                                                    <option value="0">EI</option>
                                                    <option value="1">SCI</option>
                                                    <option value="2">SSCI</option>
                                                    <option value="3">其他</option>
                                                </select>
                                            </div>
                                        </div>
                                        <!--note-->
                                        <div class="layui-form-item" id="addOrEditPub-note" style="display:auto">
                                            <label class="layui-form-label" style="width:100px">Note</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="note" placeholder="Note" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <!--按钮建-->
                                        <div class="layui-form-item">
                                            <div class="layui-input-block">
                                                <button class="layui-btn" lay-submit lay-filter="editFormSubmit">提交</button>
                                                <button type="reset" class="layui-btn layui-btn-primary" lay-submit lay-filter="resetPubPanel">重置</button>
                                                <!--<button class="layui-btn layui-btn-primary" id="cancelEditPanel">取消</button>-->
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div id="uploadPubFile" class="collapse">
                                    <div class="layui-upload">
                                        <button type="button" class="layui-btn layui-btn-normal" id="chooseFile">选择文件</button>
                                        <div class="layui-upload-list">
                                            <table class="layui-table">
                                                <thead>
                                                    <tr>
                                                        <th>文件名</th>
                                                        <th>大小</th>
                                                        <th>状态</th>
                                                        <th>操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="uploadFileTable">

                                                </tbody>
                                            </table>
                                        </div>
                                        <button type="button" class="layui-btn" id="uploadFileButton">开始上传</button>
                                        <!--显示导入的文献列表-->
                                        <div>
                                            <button>
                                                显示结果！！！！
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                        <div id="advanceSearch" class="collapse" >
                            <form class="layui-form" action="">
                                <!--关键词-->
                                <div class="layui-form-item">
                                    <label class="layui-form-label" style="width:100px">关键词</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="title" required  lay-verify="required" placeholder="请输入关键字，以逗号分隔" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <!--时间范围-->
                                <div class="layui-form-item">
                                    <label class="layui-form-label" style="width:100px">时间范围</label>
                                    <div class="layui-input-inline" style="margin-left:10px">
                                        <input id="startTime" type="text" name="startTime"  placeholder="From" autocomplete="off" class="layui-input">
                                    </div>
                                    <div class="layui-form-mid layui-word-aux">-</div>
                                    <div class="layui-input-inline">
                                        <input id="endTime" type="text" name="endTime" placeholder="To" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <!--作者排名-->
                                <div class="layui-form-item">
                                    <label class="layui-form-label" style="width:100px">作者排名</label>
                                    <div class="layui-input-block">
                                        <select lay-verify="required" multiple>
                                            <option value="-1">全选</option>
                                            <option value="0">1</option>
                                            <option value="1">2</option>
                                            <option value="2">3</option>
                                            <option value="3">4</option>
                                            <option value="4">其他</option>
                                            <option value="5">通讯作者</option>
                                        </select>
                                    </div>
                                </div>
                                <!--文章索引-->
                                <div class="layui-form-item">
                                    <label class="layui-form-label" style="width:100px">文章索引</label>
                                    <div class="layui-input-block">
                                        <select name="paperIndexing" lay-verify="required" multiple>
                                            <option value="-1">全选</option>
                                            <option value="0">EI</option>
                                            <option value="1">SCI</option>
                                            <option value="2">SSCI</option>
                                        </select>
                                    </div>
                                </div>
                                <!--文章类型-->
                                <div class="layui-form-item">
                                    <label class="layui-form-label" style="width:100px">文章类型</label>
                                    <div class="layui-input-block">
                                        <select name="paperType" lay-verify="required" multiple>
                                            <option value="-1">全选</option>
                                            <option value="0">Journal Paper</option>
                                            <option value="1">Conference Paper</option>
                                            <option value="2">Book</option>
                                        </select>
                                    </div>
                                </div>
                                <!--按钮建-->
                                <div class="layui-form-item">
                                    <div class="layui-input-block">
                                        <button class="layui-btn" lay-submit lay-filter="formDemo">搜索</button>
                                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <!--成果列表-->
                    <div>
                        <table class="layui-hide" id="test"></table>
                    </div>
                </div>
                <!--右侧3.2关系网络-->
                <div id="collapse3-2-content" style="display:none">
                    <h1 class="page-header">网络</h1>

                    <div id="mynetwork2">
                        <div class="vis-network" tabindex="900" style="position: relative; overflow: hidden; touch-action: pan-y; user-select: none; -webkit-user-drag: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); width: 100%; height: 100%;">
                            <canvas width="1200" height="800" style="position: relative; touch-action: none; user-select: none; -webkit-user-drag: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); width: 100%; height: 100%;">
                            </canvas>
                        </div>
                    </div>
                </div>



            </div>

    </div>

    <div class="site-text site-block" id="verifyUserPwdForm" style="display:none">
        <form class="layui-form" action="">
            <!--用户名-->
            <div class="layui-form-item" id="verifyUserPwdForm-user">
                <label class="layui-form-label" style="width:100px">用户名</label>
                <div class="layui-input-block">
                    <input type="text" name="editUser" placeholder="" autocomplete="off" class="layui-input">
                </div>
            </div>
            <!--密码-->
            <div class="layui-form-item" id="verifyUserPwdForm-pwd">
                <label class="layui-form-label" style="width:100px">密码</label>
                <div class="layui-input-block">
                    <input type="password" name="editPwd" placeholder="" autocomplete="off" class="layui-input">
                </div>
            </div>

            <!--按钮建-->
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn layui-btn-primary" lay-submit lay-filter="verifyFormSubmit">提交</button>
                </div>
            </div>
        </form>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- Just to make our placeholder images work. Don't actually copy the next line! -->
    <script src="{% static 'bootstrap-4.1.1-dist/js/vendor/holder.min.js'%}"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="{% static 'bootstrap-4.1.1-dist/js/ie10-viewport-bug-workaround.js'%}"></script>
    <script type="text/javascript">


        var sideBarListLength = 4;
        var sideBarLengths = [2,2,2,2];
        // actions when clicking the side bar items, collapsing the side bar items
        $(document).ready(function() {
                $('.panel-title').click(function(){
                    var theHref = $(this).attr('href');
                    if (theHref != null) {
                        $(this).click(collapseSideBar(theHref));
                    }
                });
         });

         // actions when clicking the side bar items, changing active item, showing the corresponding content
         $(document).ready(function(){
            $(" li").click(function(){
                var actId = $(this).attr('id');
                if (actId != null) {
                    $(this).click(clickSideBar(actId));
                }
            });
         });

    </script>


    <script>
        //作者表格初始化及监听操作
        var currentAuthors;
        var reloadAuthorTable = {
            reload: function(){

                var $ = layui.$, demoReload = $('#authorTable');

                //执行重载
                layui.table.reload('authorTable', {
                    where: {
                        currentData: JSON.stringify(currentAuthors)
                    }
                });
            }
        };
        layui.use('table', function(){
            var table = layui.table;

            var $ = layui.$;

            //监听工具按钮
            table.on('tool(demo)', function(obj){
                var data = obj.data;
                if(obj.event === 'addAuthor'){
                    if (validAuthor(data.firstName, data.lastName) == false) {
                        layer.msg("请填写完整一位作者的信息再添加下一位作者");
                    }else {
                        if (isNaN(validRanking(data["ranking"]))) {
                            layer.msg("作者排名应为非负整数");
                        }else {
                            var type = $(this).data('type');
                            if (type == "reload"){
                                reloadAuthorTable[type].call(this);
                            }
                        }
                    }
                } else if(obj.event === 'delAuthor'){
                    layer.confirm('确认删除数据行(' + obj.data["ranking"]+ ')？', function(index){
                        if (currentAuthors.length==1) {
                            layer.msg("最少需要制定一位作者。");
                            return
                        }
                        var emptyRows = [], counter = 0;

                        for (i=0;i<currentAuthors.length;i++) {
                            if (identicalAuthorInfo(currentAuthors[i], obj.data)){
                                emptyRows[counter] = i;
                                counter++;
                            }
                        }
                        for (i=emptyRows.length-1;i>-1;i--) {
                            currentAuthors.splice(emptyRows[i],1);
                        }

                        obj.del();
                        layer.close(index);
                    });
                }
            });

            //监听单元格编辑
            table.on('edit(demo)', function(obj){
                var value = obj.value //得到修改后的值
                    ,data = obj.data //得到所在行所有键值
                    ,rowIndex = obj.data.LAY_TABLE_INDEX //所在行LAY_TABLE_INDEX下标
                    ,field = obj.field; //得到字段
                //获取在currentAuthors中下标
                for (i=0;i<currentAuthors.length;i++) {
                    if (currentAuthors[i]["LAY_TABLE_INDEX"]==rowIndex) {
                        rowIndex = i;
                        break;
                    }
                }
                //判断ranking是否已经存在
                if (field == "ranking") {
                    var tmpAuthors = deepClone(currentAuthors);
                    tmpAuthors.splice(rowIndex);
                    if (tmpAuthors == false) {
                        value = validRanking(value);
                        if (isNaN(value)) {
                            layer.msg("作者排名需为非负整数。");
                            resetRanking(rowIndex, currentAuthors[rowIndex]);
                        }else {
                            if (currentRankings.indexOf(value)) {
                                later.msg("作者排名不能重复");
                                resetRanking(rowIndex, currentAuthors[rowIndex]);
                            }else {
                                currentAuthors[rowIndex][field] = value;
                            }
                        }
                    }else {
                        var currentRankings = extractRankings(tmpAuthors);
                        if (currentRankings == false) {
                            console.log("解析表格中排名信息错误");
                        }else {
                            value = validRanking(value);
                            if (isNaN(value )) {
                                layer.msg("作者排名需为非负整数。");
                                resetRanking(rowIndex, currentAuthors[rowIndex]);
                            }else {
                                if (currentRankings.indexOf(value)) {
                                    later.msg("作者排名不能重复");
                                    resetRanking(rowIndex, currentAuthors[rowIndex]);
                                }else {
                                    currentAuthors[rowIndex][field] = value;
                                }
                            }
                        }
                    }
                }else {
                    currentAuthors[rowIndex][field] = value;
                }
            });

            table.render({
                elem: '#idTest'
                ,url: '/demo/table/user/'
                ,cols: [[
                  {field:'firstName', title:'名', width:100, edit: 'text'}
                  ,{field:'middleName', title:'中间名', width:100, edit: 'text'}
                  ,{field:'lastName', title:'姓', width:100, edit: 'text'}
                  ,{field:'ranking', title:'排名', width:100, sort: true, edit: 'text'}
                  ,{width:150, align:'center', toolbar: '#barDemo'}
                ]]
                ,id: 'authorTable'
                ,page: false
                ,done: function(res, curr, count){
                    currentAuthors = deepClone(res["data"]);
                }
            });

        });

    </script>

    <script>
        var currentUser = "";
        var currentPwd = "";
        var addOrEditPanelState = 0; //0无状态，1新增，2编辑,
        layui.use(['layer', "form", "table"],function(){
            var layer = layui.layer
                ,form = layui.form
                ,table = layui.table;

            var active = {
                editPub:function(){}
                ,verification:function(params){
                    //要求输入用户名和密码，并发送请求验证是否成功，返回1：验证成功，2：验证失败，3：取消验证
                    layer.open({
                        type: 1
                        ,title: "用户验证"
                        ,content: $("#verifyUserPwdForm") //表单内容
                        ,id: 'verifyUserLayer' //防止重复弹出
                        ,success: function(layerN, index){//打开层成功后的动作,当前层DOM当前层索引
                            //监听表单
                        }
                        ,cancel: function(index, layerN){//右上角关闭按钮触发的回调
                            layer.close(index)
                        }
                    });//打开确认页面
                }
                , sendAuth: function(params){//发送user和pwd验证请求,1：验证成功；2:验证失败
                    var uUser = this["username"]
                        ,uPwd = this["pwd"];
                    if (uUser=="" || uPwd == "") {
                        return 2;
                    }else{
                        var pp = $.ajax({
                            type: 'GET'
                            ,url: siteUrl + authService
                            ,data: {"username":uUser,"pwd":uPwd}
                            ,dataType : "json"
                            ,headers: {'Content-Type': 'application/json',"X-CSRFToken":csrftoken}
                            ,contentType: "application/json"
                            ,beforeSend: function(){
                                console.log("发送验证请求");
                            }
                            ,success: function(result,status,xhr) {
                                console.log("ok，验证结果：" + JSON.stringify(result));
                                if (result["status"] > 0){
                                    console.log("验证成功");
                                    currentUser = result["user"];
                                    currentPwd = result["pwd"];
                                    return 1;
                                }else{
                                    console.log("验证失败");
                                    return 2;
                                }
                            }
                            ,error: function(xhr,status,error){
                                //如果请求失败要运行的函数
                                console.log("发送验证请求失败。");
                                return 2;
                            }
                            ,complete: function(xhr,status){
                                //完成时的操作，success和error之后
                                console.log(status)
                            }

                        });
                        return pp;
                    }
                }
            };
            //验证用户名和密码的提交按钮
            form.on("submit(verifyFormSubmit)", function(data){
                var params = {"username": data.field["editUser"], "pwd": data.field["editPwd"]};
                var pp = active["sendAuth"].call(params);
                return false;
            });

        });
        //点击新增文献的事件
        $("#addPub").on("click", function(){
            layui.use(['form','table', 'layer'], function(){
                var table = layui.table
                    ,layer = layui.layer
                    ,form = layui.form;
                var collapseState = $("#addOrEditPub").attr("class");
                if (collapseState.indexOf("collapse in")>-1) {//展开时：1）编辑模式：清空内容，不折叠；新增模式：关闭，可不清空内容
                    if (addOrEditPanelState==1) {//add
                        $("#addOrEditPub").attr("class", collapseState.replace('collapse in', "collapse"));
                    }else if (addOrEditPanelState==2){//edit
                        toggleEditPanel(0);
                        form.render();
                        addOrEditPanelState = 1;
                    }else {
                        console.log("未知文献详情面板状态");
                    }
                }else{//关闭时，展开，清空内容
                    toggleEditPanel(0);
                    form.render();
                    $("#addOrEditPub").attr("class", collapseState.replace('collapse', "collapse in"));
                }
            });
        });
        //点击编辑文献的事件
        $('#editPub').on('click', function(){
            layui.use(['form','table', 'layer'], function(){
                var table = layui.table
                    ,layer = layui.layer
                    ,form = layui.form;
                //点击编辑按钮后操作(0)判断当前面板是否展开状态，若否，则展开，并显示文献内容，否则，将内容折叠，并复原
                //（1）判断当前选中的文献个数，>1过多；<1过少
                var collapseState = $("#addOrEditPub").attr("class");
                if (collapseState.indexOf("collapse in")>-1) {//展开
                    $("#addOrEditPub").attr("class", collapseState.replace('collapse in', "collapse"));
                    //重置表格
                    toggleEditPanel(0);
                    form.render();
                }else {//关闭
                    var checkStatus = table.checkStatus('pubTable')
                        ,selectedItems = checkStatus.data;
                    if (selectedItems.length == 0) {
                        layer.msg("编辑文献时请选择欲编辑的文献。");
                        return;
                    }else if (selectedItems.length>1){
                        layer.msg("编辑文献时只能选择一篇文献。");
                        return;
                    }else{
                        //验证,并获取文献数据
                        var pubId = selectedItems[0]["uuid"];
                        if (pubId==undefined || pubId==null) {
                            layer.msg("获取不到文献的uuid");
                        }else{
                            var paperData;
                            $.ajax({
                                type: 'GET'
                                ,url: siteUrl + editPubService
                                ,data: {"id": pubId}
                                ,dataType : "json"
                                ,headers: {'Content-Type': 'application/json',"X-CSRFToken":csrftoken}
                                ,contentType: "application/json"
                                ,beforeSend: function(){
                                    console.log("发送编辑请求：" + pubId);
                                }
                                ,success: function(result,status,xhr) {
                                    //配置一个透明的询问框
                                    if (result["status"]!=1) {
                                        layer.msg("获取文献详情失败，" + result["msg"]);
                                        paperData = -1;
                                    }else{
                                        layer.msg('编辑文献：获取数据成功。' + JSON.stringify(result["data"]));
                                        console.log('编辑文献：获取数据成功。' + JSON.stringify(result));
                                        paperData = result;
                                    }
                                    if (paperData==-1){
                                        layer.msg("没有数据");
                                    }else{
                                        //要处理authors、paperTypeEdit
                                        var paperType = pubTypes.indexOf(paperData["data"]["paperTypeEdit"]);
                                        if (paperType == undefined || paperType == -1) {
                                            layer.msg("位置的文献类型！" + paperData["data"]["paperTypeEdit"]);
                                        }else{
                                        //显示编辑面板
                                            $("#addOrEditPub").attr("class", "collapse in");
                                            //自动填充表格
                                            toggleEditPanel(paperType);
                                            form.val('addOrEditPubPanel', paperData["data"]);
                                            currentAuthors = paperData["data"]["author"];
                                            reloadAuthorTable["reload"].call(this);
                                        }
                                    }
                                }
                                ,error: function(xhr,status,error){
                                    //如果请求失败要运行的函数
                                    layer.msg("编辑文献：获取文献详情失败，数据库服务器断开连接，请稍后再试。", {
                                        time: 20000, //20s后自动关闭
                                        btn: ['ok'],
                                        icon:5
                                    });
                                    console.log(error);
                                }
                                ,complete: function(xhr,status){
                                    //完成时的操作，success和error之后
                                }
                            });
                            return;
                        }
                    }
                }


            });


        });
    </script>

    <script>
        var formSettings = [{"field":"0", "mandatory":[0,1,2,3,22], "others":[4,5,6,7,8]}
                            ,{"field":"1", "mandatory":[0,1,3,9,10,22], "others":[4,5,7,8,11,12,13]}
                            ,{"field":"2", "mandatory":[1,22], "others":[0,3,7,8,12,14]}
                            ,{"field":"3", "mandatory":[0,1,3,15,22], "others":[4,5,6,7,8,9,10,11,12,16]}
                            ,{"field":"4", "mandatory":[0,1,3,6,9,10,17,22], "others":[4,5,7,8,11,12,13,18]}
                            ,{"field":"5", "mandatory":[0,1,3,10,15,22], "others":[4,5,6,7,8,9,11,12,13,17,18]}
                            ,{"field":"6", "mandatory":[0,1,3,15,22], "others":[4,5,6,7,8,9,10,11,12,16]}
                            ,{"field":"7", "mandatory":[1,22], "others":[0,3,7,8,12,13,16]}
                            ,{"field":"8", "mandatory":[0,1,3,19,22], "others":[7,8,12,18]}
                            ,{"field":"9", "mandatory":[22], "others":[0,1,3,7,8,14]}
                            ,{"field":"10", "mandatory":[0,1,3,19,22], "others":[7,8,12,20]}
                            ,{"field":"11", "mandatory":[1,3,22], "others":[4,5,7,8,9,10,11,12,16]}
                            ,{"field":"12", "mandatory":[0,1,3,21,22], "others":[5,7,8,9,18]}
                            ,{"field":"13", "mandatory":[0,1,8,22], "others":[3,7]}
                            ];
        var contentStringName = ["author","title","journal","year","volume","number",
                                "pages","month","note","editor","publisher","series","address",
                                "edition","howpublished","booktitle","organization","chapter",
                                "type","school","keywords","institution","indexing"];
        var pubTypes = ["ARTICLE", "BOOK","BOOKLET","CONFERENCE","INBOOK","INCOLLECTION","INPROCEEDINGS",
                         "MANUAL","MASTERSTHESIS","MISC","PHDTHESIS","PROCEEDINGS","TECHREPORT","UNPUBLISHED"];
        var currentPubType = 0;

        var siteUrl = "http://127.0.0.1:8000"
            ,addPubService = "/add-pub/"
            ,editPubService = "/edit-pub/"
            ,authService = "/verify/";
        var csrftoken = Cookies.get('csrftoken');
        //表单的操作:包括文献详情、高级搜索

        layui.use(['form', 'layedit'], function(){
            var form = layui.form
                ,layer = layui.layer;

            //重置编辑面板
            form.on('submit(resetPubPanel)', function(){
                //文献类型自动重置了
                toggleEditPanel(0);
                form.render();
            });
            //提交文献信息
            form.on('submit(editFormSubmit)', function(data){
                console.log("提交的表单数据：" + JSON.stringify(data.field));
                msg = verifyPubInfo(data.field);
                if (msg["status"]<1) {
                    layer.msg(msg["msg"]);
                    console.log("结束验证，验证失败");
                }else{
                    console.log("结束验证，验证正确");

                    $.ajax({
                        type: 'POST'
                        ,url: siteUrl + addPubService
                        ,data: msg["processedData"]
                        ,dataType : "json"
                        ,headers: {'Content-Type': 'application/json',"X-CSRFToken":csrftoken}
                        //,contentType: "application/json"
                        ,beforeSend: function(){
                            console.log(msg["processedData"]);
                        }
                        ,success: function(result,status,xhr) {
                            //配置一个透明的询问框
                            layer.msg('新增文献成功！<br>' + JSON.stringify(msg["processedData"]), {
                                time: 20000, //20s后自动关闭
                                btn: ['ok'],
                                icon:1
                            });
                            console.log("ok" + result);
                        }
                        ,error: function(xhr,status,error){
                            //如果请求失败要运行的函数
                            layer.msg("添加数据失败，与数据库服务器断开连接，请稍后再试。", {
                                time: 20000, //20s后自动关闭
                                btn: ['ok'],
                                icon:5
                            });
                            console.log(error);
                        }
                        ,complete: function(xhr,status){
                            //完成时的操作，success和error之后
                        }

                    });
                }
                return false;
            });
            //监听文献编辑面板显示的内容
            form.on('select(paperTypeEdit)', function(data){
                var value = data.value;
                value = new Number(value);
                if (value.valueOf() != currentPubType.valueOf()) {
                    toggleEditPanel(value);
                    form.render();
                }
            });

            //监听下拉复选框全选功能:包括高级搜索面板
            form.on('checkbox', function(data){
                var allOptions = data.elem.parentElement
                        .parentElement
                        .parentElement
                        .parentElement
                        .parentElement
                        .children.item("select").children;
                if (data.elem.title=="全选"){
                    if (data.elem.checked) {
                        for (i=0;i<allOptions.length;i++) {
                            allOptions[i].setAttribute("selected",true);
                        }
                    }else {
                        for (i=0;i<allOptions.length;i++) {
                            allOptions[i].removeAttribute("selected");
                        }
                    }
                    form.render('select');
                    form.render('checkbox');
                }
            });

            //表单验证:参数是name：value形式
            function verifyPubInfo(data) {
                var pubType = new Number(data["paperTypeEdit"])
                    ,mandatory = formSettings[pubType]["mandatory"]
                    ,others = formSettings[pubType]["others"];
                var msg = {"status": 2, "msg":""};
                var processedData = {};
                console.log("开始验证必填字段");
                for (i=0;i<mandatory.length;i++) {//判断必填字段
                    var valueNames = [];
                    if (mandatory[i]==0) { //作者单独判断
                        var tmpMsg = verifyAuthor();
                        if (tmpMsg["status"]<0) {
                            console.log("必填：作者验证失败");
                            msg["status"] = tmpMsg["status"];
                            msg["msg"] = tmpMsg["msg"];
                            break;
                        }else{
                            console.log("必填：作者验证成功");
                            processedData["author"] = currentAuthors;
                            continue;
                        }
                    }else if (mandatory[i]==6) { //pages
                        console.log("验证pages");
                        valueNames = ["pages1","pages2"];
                    }else {
                        console.log("验证：" + contentStringName[mandatory[i]]);
                        valueNames = [contentStringName[mandatory[i]]];
                    }
                    var validFlag = true;
                    for (j=0;j<valueNames.length;j++) {
                        console.log("开始验证必填字段：" + valueNames[j]);
                        if (data.hasOwnProperty(valueNames[j])) {//判断表单中是否有字段
                            console.log("开始验证表单内容：" + valueNames[j] + ",值：" + data[valueNames[j]]);
                            msg = verifyFieldValue(valueNames[j], data[valueNames[j]]); // 判断是否为空及数字字段验证
                            if (msg["status"] < 1) {//表单填写错误
                                console.log("表单填写错误");
                                validFlag = false;
                                break;
                            }else if (msg["status"]==-2) {
                                console.log("不存在此字段");
                                msg["msg"] += " 不存在此字段";
                            }else {//填写正确
                                console.log("填写正确");
                                processedData[valueNames[j]] = data[valueNames[j]];
                            }
                        }else {
                            console.log("缺少此字段：" + valueNames[j]);
                            msg = {"msg":"Missing field name[" + valueNames[j] + "]", "status": -1};
                            validFlag = false;
                            break;
                        }
                    }
                    if (validFlag == false) {
                        console.log("必填字段验证失败，退出验证（outer）");
                        break;
                    }
                }
                if (msg["status"]<1) {
                    console.log("必填字段验证失败，退出验证");
                    return msg;
                }
                console.log("开始验证选填字段");
                for (i=0;i<others.length;i++) {//判断选填字段
                    if (others[i]==0) { //作者单独判断
                        var tmpMsg = verifyAuthor();
                        if (tmpMsg["status"]<0) {
                            console.log("选填：作者验证失败");
                            msg["status"] = tmpMsg["status"];
                            msg["msg"] = tmpMsg["msg"];
                            break;
                        }else{
                            console.log("必填：作者验证成功");
                            processedData["author"] = currentAuthors;
                            continue;
                        }
                    }else if (others[i]==6) { //pages
                        console.log("选：pages");
                        valueNames = ["pages1","pages2"];
                    }else {
                        console.log("选：" + contentStringName[others[i]]);
                        valueNames = [contentStringName[others[i]]];
                    }
                    for (j=0;j<valueNames.length;j++) {
                        if (data.hasOwnProperty(valueNames[j])) {//判断表单中是否有字段
                            console.log("选：开始验证：" + valueNames[j] + ",值：" + data[valueNames[j]]);
                            msgMsg = verifyFieldValue(valueNames[j], data[valueNames[j]]); // 判断是否为空及数字字段验证
                            if (msgMsg["status"]==-1) {//表单填写错误
                                console.log("选：表单填写错误");
                                msg["msg"] += "\n Field [" + valueNames[j] + "] should be number.";
                                msg["status"] = -1;
                            }else if (msgMsg["status"]==-2) {
                                console.log("选：字段名不存在");
                                msg["msg"] += "\n Field [" + valueNames[j] + "] 不存在";
                                msg["status"] = -1;
                            }else {//填写正确 或 为空
                                console.log("选：验证正确");
                                processedData[valueNames[j]] = data[valueNames[j]];
                            }
                        }else {
                            console.log("选：字段名不存在");
                            msg["msg"] += "\n Missing field [" + valueNames[j] + "]";
                        }
                        if ( msg["status"] < 0) {
                            console.log("选：验证失败");
                            break;
                        }
                    }

                    if ( msg["status"] < 0) {
                        break;
                    }
                }
                msg["processedData"] = processedData;

                console.log("退出验证");
                return msg;
            }
            //判断表单中字段:0 字段空；-1 应为数字的字段值非数字；1正常;-2 字段名不存在
            function verifyFieldValue(fieldName, valueInForm) {
                if (fieldName == 'pages1' || fieldName == 'pages2' ) {
                    fieldName = 'pages' ;
                }
                var index = contentStringName.indexOf(fieldName);
                var numberFieldIndices = [3,4,5,6,7,13,17];
                if (index<0) {// non-existing field
                    return {"msg":"Unrecognized field name.", "status": -2};
                }else if (numberFieldIndices.indexOf(index)>-1) { // number field
                    var tmp = new Number(valueInForm);
                    if (isNaN(tmp)) {//非数字
                        return {"msg":"Field [" + fieldName + "] should be Number.", "status": -1};
                    }else if (tmp==0) { //空字符或0
                        if (valueInForm==""){
                            return {"msg":"Empty string or number 0", "status": 0};
                        }
                    }
                }else { // string field
                    if (valueInForm == "") {
                        return {"msg":"Field [" + fieldName + "] is empty", "status": 0};
                    }
                }
                return {"msg":"OK.", "status": 1};
            }
            function verifyAuthor(){
                msg = {"status": 1, "msg": "OK"};
                if (currentAuthors.length==0) {
                    msg["status"] = -1;
                    msg["msg"] = "没有作者信息";
                }else {
                    for (i=0;i<currentAuthors.length;i++) {
                        if (currentAuthors[i]["firstName"]=="" || currentAuthors[i]["lastName"]=="" || currentAuthors[i]["ranking"]=="") {
                            msg["status"] = -1;
                            msg["msg"] = "第" + new Number(i).toString() + "作者信息不全";
                            break;
                        }
                    }
                }
                return msg;
            }

        });
    </script>

    <script>
    // 高级搜索时间范围
    layui.use('laydate', function(){
        var laydate = layui.laydate;
        var myDate = new Date();

        //高级搜索(1):起始年范围, 限定可选时间
        var ins2 = laydate.render({
            elem: '#startTime'
            ,type: 'year'
            ,range: false
            ,max: myDate.toLocaleDateString()     //获取当前日期
            ,min: '1900-01-01'
            ,showBottom: false
            ,change: function(value, date, endDate){
                var $ = jQuery = layui.$;
                var endTime = document.getElementById('endTime').value;
                if (endTime < value){
                    //不能更早
                    ins2.hint('起始时间不可晚于终止时间');
                }else {
                    $("#startTime").val(value);
                    if($(".layui-laydate").length){
                        $(".layui-laydate").remove();
                    }
                }
            }
        });

        //高级搜索(2):终止年范围, 限定可选时间
        var ins1 = laydate.render({
            elem: '#endTime'
            ,type: 'year'
            ,range: false
            ,max: myDate.toLocaleDateString()     //获取当前日期
            ,min: '1900-01-01'
            ,showBottom: false
            ,isInitValue: true
            ,value: myDate.getFullYear()
            ,change: function(value, date, endDate){
                var $ = jQuery = layui.$;
                var startTime = document.getElementById('startTime').value;
                if (startTime != "" && startTime > value){
                    //不能更早
                    ins1.hint('终止时间不可超过起始时间');
                }else {
                    $("#endTime").val(value);
                    if($(".layui-laydate").length){
                        $(".layui-laydate").remove();
                    }
                }
            }
        });

        //文献信息form(1):文献时间年
        var ins3 = laydate.render({
            elem: '#pubYear'
            ,type: 'year'
            ,range: false
            ,showBottom: true
            ,isInitValue: false
            ,change:function(value, date, endDate) {
                console.log(value);
            }
        });
        //文献信息form(2):文献时间月
        var ins3 = laydate.render({
            elem: '#pubMonth'
            ,type: 'month'
            ,range: false
            ,format: 'MM'
            ,showBottom: true
            ,isInitValue: false
            ,change:function(value, date, endDate) {
                console.log(value);
            }
        });

    });
    </script>

    <script>
    // 文献表格创建
    var tableInit = false;
    var parameters;
    //打开页面时定位位置
    var loadPosition = {{ position|safe }};
    if (loadPosition != 'null'){
        clickSideBar(loadPosition + '-1');
        collapseSideBar('#' + loadPosition);
        parameters = {authorIndex:NaN, paperIndexing:NaN, keywords:NaN, years:NaN};
        loadTableData(parameters);
    }
    //点击事件
    $("#collapse3-1").click(function(){
        if (tableInit) {
            collectParameters();
            parameters = {authorIndex:NaN, paperIndexing:NaN, keywords:NaN, years:NaN};
            loadTableData(parameters);
            tableInit = false;
        }else {
            //从参数输入框中检查参数
            parameters = {authorIndex:NaN, paperIndexing:NaN, keywords:NaN, years:NaN};
            //validParams = checkParameters(parameters);
            validParams = true;
            if (validParams) {
                // 参数正确，进行搜索
                //tableInit = false;
                loadTableData(parameters);
                return 1;
            }else{
                // 参数不正确，没有后续操作
                return -1;
            }
        }
    });

    // 获取表格高级搜索参数---未完成
    function collectParameters() {
        var startYear = $("#startTime").val();
        var endYear = $("#startTime").val();
    }

    // 检查高级搜索中参数是否合理；时间参数已在该处设置过；
    function checkParameters(parameters) {
        return true;
    }
    function loadTableData(params) {
        var serviceName = '/sample-data/';
        var requestUrl = serviceName + "?";
        layui.use('table', function(){
            var table = layui.table;
            table.render({
                elem: '#test'
                ,id: "pubTable"
                ,url:'/sample-data/'
                //,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
                ,page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
                        layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                        //,curr: 5 //设定初始在第 5 页
                        ,groups: 5 //只显示 1 个连续页码
                        ,first: false //不显示首页
                        ,last: false //不显示尾页
                    }
                ,limit: 10
                ,cols: [[
                    {checkbox : true, LAY_CHECKED : false}
                    ,{field:'ID', width:60, title: 'ID', sort: true}
                    ,{field:'TITLE', width:300, title: '标题', sort: false}
                    ,{field:'AUTHORS', width:200, title: '作者', sort: false}
                    ,{field:'VENUE', width:200, title: '期刊/会议'}
                    ,{field:'YEAR', title: '年', width: '70', minWidth: 10} //minWidth：局部定义当前单元格的最小宽度，layui 2.2.1 新增
                    ,{field:'VENUE_TYPE', width: '100', title: '类型', sort: true}
                ]]
                ,done: function(data){
                    console.log("data");
                    console.log(data);
                }
            });
        });
    }
    </script>

    <script>
        //表格面板折叠功能
        layui.use(['element', 'layer'], function(){
            var element = layui.element;
            var layer = layui.layer;

            //监听折叠
            element.on('collapse', function(data){
                //layer.msg('展开状态：'+ data.show);
            });
        });
        // 文献表格高级搜索文字
        function toggleAdvanceSearch(){
            var operatePub = document.getElementById("operatePubs");
            if (document.getElementById("advanceSearchButton").innerHTML == "高级搜索") {
                document.getElementById("advanceSearchButton").innerHTML = "收起";
                if (operatePub.className.includes("collapse in"))  {
                    operatePub.className = "collapse";
                }
                document.getElementById("addPublicationButton").innerHTML = "操作文献";
                foldEditPanel();
            }else {
                document.getElementById("advanceSearchButton").innerHTML = "高级搜索";
            }
        }
        // 文献操作面板文字
        function togglePubOperation(){
            var operatePub = document.getElementById("advanceSearch");
            if (document.getElementById("addPublicationButton").innerHTML == "操作文献") {
                document.getElementById("addPublicationButton").innerHTML = "取消操作";
                if (operatePub.className.includes("collapse in"))  {
                    operatePub.className = "collapse";
                }
                document.getElementById("advanceSearchButton").innerHTML = "高级搜索";
                foldEditPanel();
            }else {
                document.getElementById("addPublicationButton").innerHTML = "操作文献";
            }
        }
        //关闭文献编辑面板并重置
        function foldEditPanel() {
            var operatePub = document.getElementById("addOrEditPub");
            if (operatePub.className.includes("collapse in"))  {
                operatePub.className = "collapse";
            }
            toggleEditPanel(0);
            //重置文献类型下拉框

            $("button[lay-filter='resetPubPanel']").trigger("click");
        }
        //关闭/开启文献编辑面板Item
        function toggleEditPanel(value) {
            var mandatory = formSettings[value]["mandatory"],
                others = formSettings[value]["others"];
            for (i=0;i<contentStringName.length;i++) {
                var element = $("#addOrEditPub-" + contentStringName[i])
                    ,subInput = element.find('input');
                if (mandatory.includes(i)) {
                    element.attr("style", "display:auto");
                    if (subInput.length>0) {
                        for (j=0;j<subInput.length;j++) {
                            subInput[j].placeholder = "必填";
                        }
                    }
                }else if (others.includes(i)){
                    element.attr("style", "display:auto");
                    if (subInput.length>0) {
                        for (j=0;j<subInput.length;j++) {
                            subInput[j].placeholder = "选填";
                        }
                    }
                }else {
                    element.attr("style", "display:none");
                }
            }
            currentPubType = value.valueOf();
        }
    </script>

    <script>
    // 上传文件操作
    layui.use('upload', function(){
        var upload = layui.upload;
        var demoListView = $('#uploadFileTable')
            ,uploadListIns = upload.render({
                elem: '#chooseFile'
                ,url: '/upload/'
                ,accept: 'file'
                ,multiple: true
                ,auto: false
                ,bindAction: '#uploadFileButton'
                ,choose: function(obj){
                    var files = this.files = obj.pushFile(); //将每次选择的文件追加到文件队列
                    //读取本地文件
                    obj.preview(function(index, file, result){
                        var tr = $(['<tr id="upload-'+ index +'">'
                            ,'<td>'+ file.name +'</td>'
                            ,'<td>'+ (file.size/1014).toFixed(1) +'kb</td>'
                            ,'<td>等待上传</td>'
                            ,'<td>'
                            ,'<button class="layui-btn layui-btn-mini demo-reload layui-hide">重传</button>'
                            ,'<button class="layui-btn layui-btn-mini layui-btn-danger demo-delete">删除</button>'
                            ,'</td>'
                            ,'</tr>'].join(''));

                        //单个重传
                        tr.find('.demo-reload').on('click', function(){
                            obj.upload(index, file);
                        });

                        //删除
                        tr.find('.demo-delete').on('click', function(){
                            delete files[index]; //删除对应的文件
                            tr.remove();
                            uploadListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
                        });

                        demoListView.append(tr);
                    });
                }
                ,done: function(res, index, upload){
                    if(res.code == 0){ //上传成功
                        var tr = demoListView.find('tr#upload-'+ index)
                            ,tds = tr.children();
                        tds.eq(2).html('<span style="color: #5FB878;">上传成功</span>');
                        tds.eq(3).html(''); //清空操作
                        return delete this.files[index]; //删除文件队列已经上传成功的文件
                    }
                    this.error(index, upload);
                }
                ,error: function(index, upload){
                    var tr = demoListView.find('tr#upload-'+ index)
                        ,tds = tr.children();
                    tds.eq(2).html('<span style="color: #FF5722;">上传失败</span>');
                    tds.eq(3).find('.demo-reload').removeClass('layui-hide'); //显示重传
                }
            });
    });
    </script>

    <script>
    // ajax 获取网络图
    var haveGotGraph = 0
    var haveGotGrap32 = 0
    var request;
    if (window.XMLHttpRequest){
        // code for IE7+, Firefox, Chrome, Opera, Safari
        request=new XMLHttpRequest();
    }else {
        // code for IE6, IE5
        request=new ActiveXObject("Microsoft.XMLHTTP");
    }
    $('#collapse2-2').click(function() {
        if (haveGotGraph==0) {
            request.onreadystatechange = function () { // 状态发生变化时，函数被回调
                if (request.readyState === 4) { // 成功完成
                    // 判断响应结果:
                    if (request.status === 200) {
                        // 成功，通过responseText拿到响应的文本:
                        haveGotGraph = 1;
                        return success(request.responseText, "mynetwork");
                    } else {
                        // 失败，根据响应码判断失败原因:
                        return fail(request.status);
                    }
                } else {
                    // HTTP请求还在继续...
                }
            }
            request.open('GET', 'vis-data/');
            request.send();
        }
    });
    $('#collapse3-2').click(function() {
        if (haveGotGrap32==0) {
            request.onreadystatechange = function () { // 状态发生变化时，函数被回调
                if (request.readyState === 4) { // 成功完成
                    // 判断响应结果:
                    if (request.status === 200) {
                        // 成功，通过responseText拿到响应的文本:
                        haveGotGrap32 = 1;
                        return success(request.responseText, "mynetwork2");
                    } else {
                        // 失败，根据响应码判断失败原因:
                        return fail(request.status);
                    }
                } else {
                    // HTTP请求还在继续...
                }
            }
            request.open('GET', 'vis-data/');
            request.send();
        }
    });

    function fail(code) {
        alert("failed to required data for vis");
    }
    function success(text, netId) {
        startNetwork(text, netId);
    }
    function continueFunc() {
        alert("continue");
    }


    var nodeIds, shadowState, nodesArray, nodes, edgesArray, edges, network;
    var nodeStyles = [{type: "publication", shape: "box", font:{size:10}, color:{background:'pink', border:'purple'}},
                     {type: "person", shape: "circle", font:{size:10}, color:{background:'cyan', border:'blue'}},
                     {type: "venue", shape: "ellipse", font:{size:10}, color:{background:'#F03976', border:'#713E7F'}}];
    var maxPersonLength =  1, maxPublicationLength = 4;


    function startNetwork(requestedResult, netId) {

        shadowState = false;
        var obj = JSON.parse(requestedResult);
        if (obj["status"] == "") {
            console.log("failed to get vis data")
        }
        edgesArray = obj["relation"];
        nodesArray = obj["nodes"];

        nodes = new vis.DataSet(nodesArray);
        edges = new vis.DataSet(edgesArray);

        nodeIds = nodes.getIds();
        nodes.forEach(function(item){
            index = 0;
            if (item.type == "person") {
                index = 1;
                nodes.update([{id:item.id, label:yourSplit(maxPersonLength, item.label)}]);
            }else if (item.type == "venue") {
                index = 2;
                nodes.update([{id:item.id, label:yourSplit(maxPublicationLength, item.label)}]);
            }else if (item.type == "publication") {
                nodes.update([{id:item.id, label:yourSplit(maxPublicationLength, item.label)}]);
            }
            nodes.update([{id:item.id, color:nodeStyles[index]["color"], shape:nodeStyles[index]["shape"], font:nodeStyles[index]["font"]}]);

        });

        // create a network
        var container = document.getElementById(netId);
        var data = {
            nodes: nodes,
            edges: edges
        };
        var options = {};
        network = new vis.Network(container, data, options);
    }

    function addNode() {
        var newId = (Math.random() * 1e7).toString(32);
        nodes.add({id:newId, label:"I'm new!"});
        nodeIds.push(newId);
    }

    function changeNode1() {
        var newColor = '#' + Math.floor((Math.random() * 255 * 255 * 255)).toString(16);
        nodes.update([{id:1, color:{background:newColor}}]);
    }

    function removeRandomNode() {
        var randomNodeId = nodeIds[Math.floor(Math.random() * nodeIds.length)];
        nodes.remove({id:randomNodeId});

        var index = nodeIds.indexOf(randomNodeId);
        nodeIds.splice(index,1);
    }

    function changeOptions() {
        shadowState = !shadowState;
        network.setOptions({nodes:{shadow:shadowState},edges:{shadow:shadowState}});
    }

    function resetAllNodes() {
        nodes.clear();
        edges.clear();
        nodes.add(nodesArray);
        edges.add(edgesArray);
    }

    function resetAllNodesStabilize() {
        resetAllNodes();
        network.stabilize();
    }

    function setTheData() {
        nodes = new vis.DataSet(nodesArray);
        edges = new vis.DataSet(edgesArray);
        network.setData({nodes:nodes, edges:edges})
    }

    function resetAll() {
        if (network !== null) {
            network.destroy();
            network = null;
        }
        startNetwork();
    }

</script>

    <script>
        //公用函数
        //1. 将长句子分成多行
        var yourSplit = function(N,string){
            var app = string.split(' '),
                arrayApp = [],
                stringApp = "";
            app.forEach(function(sentence,index){
                stringApp += sentence+' ';

                if ( (index+1)%N === 0){
                    arrayApp.push(stringApp);
                    stringApp='';
                }else if(app.length===index+1 && stringApp!==''){
                    arrayApp.push(stringApp);
                    stringApp='';
                }
            });
            var result = "";
            for (j=0; j<arrayApp.length-1;j++) {
                result += arrayApp[j] + "\n";
            }
            result += arrayApp[arrayApp.length-1];
            return result;

        };
        //2.判断是否有效姓名
        function validAuthor(firstName, lastName) {
            if (firstName == "" && lastName == "") {
                return false;
            }else {
                return true;
            }
        }
        //3.是否有效数字排名
        function validRanking(ranking) {
            rankings = new Number(ranking);
            return rankings;
        }
        //4.作者表格中提取排名值
        function extractRankings(info) {
            if (info!=undefined && info!=null) {
                var rankings = [];
                var counter = 0;
                if (isArray(info)) {
                    info.forEach(function(item){
                        ranking = validRanking(item["ranking"]);
                        if (isNaN(ranking)) {
                            console.log("当前输入的ranking值不是数字:" + JSON.stringify(item));
                        }else {
                            rankings[counter] = ranking;
                            counter++;
                        }
                    });
                }else {
                    ranking = validRanking(info["ranking"]);
                    if (isNaN(ranking)) {
                        console.log("当前输入的ranking值不是数字:" + JSON.stringify(info));
                    }else {
                        rankings[counter] = ranking;
                        counter++;
                    }
                }
                return rankings;
            }else {
                return false;
            }
        }
        // 5.判断arr是否为一个数组，返回一个bool值
        function isArray (arr) {
            return Object.prototype.toString.call(arr) === '[object Array]';
        }
        // 6.深度克隆
        function deepClone (obj) {
            if(typeof obj !== "object" && typeof obj !== 'function') {
                return obj;        //原始类型直接返回
            }
            var o = isArray(obj) ? [] : {};
            for(i in obj) {
                if(obj.hasOwnProperty(i)){
                    o[i] = typeof obj[i] === "object" ? deepClone(obj[i]) : obj[i];
                }
            }
            return o;
        }
        //7.判断两条作者信息是否相同
        function identicalAuthorInfo(item1, item2) {
            var fields = ["firstName", 'middleName', 'lastName','ranking'];
            var identical = true;
            fields.forEach(function(field) {
                if (item1.hasOwnProperty(field) && item2.hasOwnProperty(field)) {
                    if (item1[field] != item2[field]) {
                        identical = false;
                    }
                }else{
                    identical = false;
                }
            });
            return identical;
        }
        //8.取消作者表格中ranking值输入

        function resetRanking(ranking, value) {
            var tr = $("[data-index='" + new Number(ranking).toString() + "']").children("[data-field='ranking']").children("input").val(value["ranking"]);
            var tr = $("[data-index='" + new Number(ranking).toString() + "']").children("[data-field='ranking']").children("div").text(value["ranking"]);
        }
    </script>

    <style>
        /* 下拉多选样式 需要引用*/
        select[multiple]+.layui-form-select>.layui-select-title>input.layui-input{ border-bottom: 0}
        select[multiple]+.layui-form-select dd{ padding:0;}
        select[multiple]+.layui-form-select .layui-form-checkbox[lay-skin=primary]{ margin:0 !important; display:block; line-height:36px !important; position:relative; padding-left:26px;}
        select[multiple]+.layui-form-select .layui-form-checkbox[lay-skin=primary] span{line-height:36px !important; float:none;}
        select[multiple]+.layui-form-select .layui-form-checkbox[lay-skin=primary] i{ position:absolute; left:10px; top:0; margin-top:9px;}
        .multiSelect{ line-height:normal; height:auto; padding:4px 10px; overflow:hidden;min-height:38px; margin-top:-38px; left:0; z-index:99;position:relative;background:none;}
        .multiSelect a{ padding:2px 5px; background:#908e8e; border-radius:2px; color:#fff; display:block; line-height:20px; height:20px; margin:2px 5px 2px 0; float:left;}
        .multiSelect a span{ float:left;}
        .multiSelect a i {float:left;display:block;margin:2px 0 0 2px;border-radius:2px;width:8px;height:8px;padding:4px;position:relative;-webkit-transition:all .3s;transition:all .3s}
        .multiSelect a i:before, .multiSelect a i:after {position:absolute;left:8px;top:2px;content:'';height:12px;width:1px;background-color:#fff}
        .multiSelect a i:before {-webkit-transform:rotate(45deg);transform:rotate(45deg)}
        .multiSelect a i:after {-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}
        .multiSelect a i:hover{ background-color:#545556;}

        /* 下面是页面内样式，无需引用 */
        .layui-block {
            margin-bottom: 10px;
        }

        .layui-form-label {
            width: 180px;
        }
        .code {
            color: gray;
            margin-left: 10px;
        }
        .unshow>#result {
            display: none;
        }
        pre { padding: 5px; margin: 5px; }
        .string { color: green; }
        .number { color: darkorange; }
        .boolean { color: blue; }
        .null { color: magenta; }
        .key { color: red; }
    </style>


</body>
</html>